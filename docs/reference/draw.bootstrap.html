<!-- Generated by pkgdown: do not edit by hand -->
<!DOCTYPE html>
<html lang="en">
  <head>
  <meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<title>Draw bootstrap replicates — draw.bootstrap • surveysd</title>

<link rel="shortcut icon" type="image/x-icon" href="../favicon.ico">

<!-- jquery -->
<script src="https://code.jquery.com/jquery-3.1.0.min.js" integrity="sha384-nrOSfDHtoPMzJHjVTdCopGqIqeYETSXhZDFyniQ8ZHcVy08QesyHcnOUpMpqnmWq" crossorigin="anonymous"></script>
<!-- Bootstrap -->
<link href="https://maxcdn.bootstrapcdn.com/bootswatch/3.3.7/cosmo/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous">

<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa" crossorigin="anonymous"></script>

<!-- Font Awesome icons -->
<link href="https://maxcdn.bootstrapcdn.com/font-awesome/4.6.3/css/font-awesome.min.css" rel="stylesheet" integrity="sha384-T8Gy5hrqNKT+hzMclPo118YTQO6cYprQmhrYwIiQ/3axmI1hQomh7Ud2hPOy8SP1" crossorigin="anonymous">

<!-- clipboard.js -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/1.7.1/clipboard.min.js" integrity="sha384-cV+rhyOuRHc9Ub/91rihWcGmMmCXDeksTtCihMupQHSsi8GIIRDG0ThDc3HGQFJ3" crossorigin="anonymous"></script>

<!-- sticky kit -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/sticky-kit/1.1.3/sticky-kit.min.js" integrity="sha256-c4Rlo1ZozqTPE2RLuvbusY3+SU1pQaJC0TjuhygMipw=" crossorigin="anonymous"></script>

<!-- pkgdown -->
<link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script>



<meta property="og:title" content="Draw bootstrap replicates — draw.bootstrap" />

<meta property="og:description" content="Draw bootstrap replicates from survey data with rotating panel design.
Survey information, like ID, sample weights, strata and population totals per strata, should be specified to ensure meaningfull survey bootstraping." />

<meta property="og:image" content="/logo.png" />
<meta name="twitter:card" content="summary" />



<!-- mathjax -->
<script src='https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js?config=TeX-AMS-MML_HTMLorMML'></script>

<!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->


  </head>

  <body>
    <div class="container template-reference-topic">
      <header>
      <div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">surveysd</a>
        <span class="label label-danger" data-toggle="tooltip" data-placement="bottom" title="Unreleased version">0.2.0</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        <li>
  <a href="../index.html">
    <span class="fa fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li>
      <a href="../articles/Methodology.html">Methodology</a>
    </li>
    <li>
      <a href="../articles/uncertainty_analysis.html">Uncertainty analysis with surveysd</a>
    </li>
  </ul>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul>
      
      <ul class="nav navbar-nav navbar-right">
        <li>
  <a href="https://github.com/statistikat/surveysd">
    <span class="fa fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
      
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

      
      </header>

<div class="row">
  <div class="col-md-9 contents">
    <div class="page-header">
    <h1>Draw bootstrap replicates</h1>
    <small class="dont-index">Source: <a href='https://github.com/statistikat/surveysd/blob/master/R/draw.bootstrap.R'><code>R/draw.bootstrap.R</code></a></small>
    <div class="hidden name"><code>draw.bootstrap.Rd</code></div>
    </div>

    <div class="ref-description">
    
    <p>Draw bootstrap replicates from survey data with rotating panel design.
Survey information, like ID, sample weights, strata and population totals per strata, should be specified to ensure meaningfull survey bootstraping.</p>
    
    </div>

    <pre class="usage"><span class='fu'>draw.bootstrap</span>(<span class='no'>dat</span>, <span class='kw'>REP</span> <span class='kw'>=</span> <span class='fl'>1000</span>, <span class='no'>hid</span>, <span class='no'>weights</span>, <span class='no'>period</span>, <span class='kw'>strata</span> <span class='kw'>=</span> <span class='st'>"DB040"</span>,
  <span class='kw'>cluster</span> <span class='kw'>=</span> <span class='kw'>NULL</span>, <span class='kw'>totals</span> <span class='kw'>=</span> <span class='kw'>NULL</span>, <span class='kw'>single.PSU</span> <span class='kw'>=</span> <span class='fu'>c</span>(<span class='st'>"merge"</span>, <span class='st'>"mean"</span>),
  <span class='kw'>boot.names</span> <span class='kw'>=</span> <span class='kw'>NULL</span>, <span class='kw'>split</span> <span class='kw'>=</span> <span class='fl'>FALSE</span>, <span class='kw'>pid</span> <span class='kw'>=</span> <span class='kw'>NULL</span>, <span class='kw'>new.method</span> <span class='kw'>=</span> <span class='fl'>FALSE</span>)</pre>
    
    <h2 class="hasAnchor" id="arguments"><a class="anchor" href="#arguments"></a>Arguments</h2>
    <table class="ref-arguments">
    <colgroup><col class="name" /><col class="desc" /></colgroup>
    <tr>
      <th>dat</th>
      <td><p>either data.frame or data.table containing the survey data with rotating panel design.</p></td>
    </tr>
    <tr>
      <th>REP</th>
      <td><p>integer indicating the number of bootstrap replicates.</p></td>
    </tr>
    <tr>
      <th>hid</th>
      <td><p>character specifying the name of the column in <code>dat</code> containing the household ID.</p></td>
    </tr>
    <tr>
      <th>weights</th>
      <td><p>character specifying the name of the column in <code>dat</code> containing the sample weights.</p></td>
    </tr>
    <tr>
      <th>period</th>
      <td><p>character specifying the name of the column in <code>dat</code> containing the sample periods.</p></td>
    </tr>
    <tr>
      <th>strata</th>
      <td><p>character vector specifying the name of the column in <code>dat</code> by which the population was stratified.
If <code>strata</code> is a vector stratification will be assumed as the combination of column names contained in <code>strata</code>.
Setting in addition <code>cluster</code> not NULL stratification will be assumed on multiple stages, where each additional entry in <code>strata</code> specifies the stratification variable for the next lower stage. see Details for more information.</p></td>
    </tr>
    <tr>
      <th>cluster</th>
      <td><p>character vector specifying cluster in the data. If not already specified in <code>cluster</code> household ID is taken es the lowest level cluster.</p></td>
    </tr>
    <tr>
      <th>totals</th>
      <td><p>character specifying the name of the column in <code>dat</code> containing the the totals per strata and/or cluster. Is ONLY optional if <code>cluster</code> is <code>NULL</code> or equal <code>hid</code> and <code>strata</code> contains one columnname!
Then the households per strata will be calcualted using the <code>weights</code> argument. If clusters and strata for multiple stages are specified <code>totals</code> needs to be a vector of <code>length(strata)</code> specifying the column on <code>dat</code>
that contain the total number of PSUs at each stage. <code>totals</code> is interpreted from left the right, meaning that the first argument corresponds to the number of PSUs at the first and the last argument to the number of PSUs at the last stage.</p></td>
    </tr>
    <tr>
      <th>single.PSU</th>
      <td><p>either "merge" or "mean" defining how single PSUs need to be dealt with.
For <code>single.PSU="merge"</code> single PSUs at each stage are merged with the strata or cluster with the next least number of PSUs. If multiple of those exist one will be select via random draw
For <code>single.PSU="mean"</code> single PSUs will get the mean over all bootstrap replicates at the stage which did not contain single PSUs.</p></td>
    </tr>
    <tr>
      <th>boot.names</th>
      <td><p>character indicating the leading string of the column names for each bootstrap replica. If NULL defaults to "w".</p></td>
    </tr>
    <tr>
      <th>split</th>
      <td><p>logical, if TRUE split households are considered using <code>pid</code>, for more information see Details.</p></td>
    </tr>
    <tr>
      <th>pid</th>
      <td><p>column in <code>dat</code> specifying the personal identifier. This identifier needs to be unique for each person throught the whole data set.</p></td>
    </tr>
    <tr>
      <th>new.method</th>
      <td><p>logical, if TRUE bootstrap replicates will never be negative even if in some strata the whole population is in the sample. WARNING: This is still experimental and resulting standard errors might be underestimated! Use this if for some strata the whole population is in the sample!</p></td>
    </tr>
    </table>
    
    <h2 class="hasAnchor" id="value"><a class="anchor" href="#value"></a>Value</h2>

    <p>the survey data with the number of REP bootstrap replicates added as columns.</p>
<p>Returns a data.table containing the original data as well as the number of <code>REP</code> columns containing the bootstrap replicates for each repetition.<br />
The columns of the bootstrap replicates are by default labeled "w<em>Number</em>" where <em>Number</em> goes from 1 to <code>REP</code>.
If the column names of the bootstrap replicates should start with a different character or string the parameter <code>boot.names</code> can be used.</p>
    
    <h2 class="hasAnchor" id="details"><a class="anchor" href="#details"></a>Details</h2>

    <p><code>draw.bootstrap</code> takes <code>dat</code> and draws <code>REP</code> bootstrap replicates from it.
<code>dat</code> must be household data where household members correspond to multiple rows with the same household
identifier. The data should at least containt the following columns:</p><ul>
<li><p>Column indicating the sample period;</p></li>
<li><p>Column indicating the household ID;</p></li>
<li><p>Column containing the household sample weights;</p></li>
<li><p>Columns by which population was stratified during the sampling process.</p></li>
</ul>
    <p>For single stage sampling design a column the argument <code>totals</code> is optional, meaning that a column of the number of PSUs at the first stage does not need to be supplied.
For this case the number of PSUs is calculated and added to <code>dat</code> using <code>strata</code> and <code>weights</code>. By setting <code>cluster</code> to NULL single stage sampling design is always assumed and
if <code>strata</code> contains of multiple column names the combination of all those column names will be used for stratification.<br />
In the case of multi stage sampling design the argument <code>totals</code> needs to be specified and needs to have the same number of arguments as <code>strata</code>.<br /></p>
<p>If <code>cluster</code> is <code>NULL</code> or does not contain <code>hid</code> at the last stage, <code>hid</code> will automatically be used as the final cluster. If, besides <code>hid</code>, clustering in additional stages is specified the number of column names in
<code>strata</code> and <code>cluster</code> (including <code>hid</code>) must be the same. If for any stage there was no clustering or stratification one can set "1" or "I" for this stage.<br />
For example <code>strata=c("REGION","I"),cluster=c("MUNICIPALITY","HID")</code> would speficy a 2 stage sampling design where at the first stage the municipalities where drawn stratified by regions
and at the 2nd stage housholds are drawn in each municipality without stratification.<br /></p>
<p>Bootstrap replicates are drawn for each survey period (<code>period</code>) using the function <a href='rescaled.bootstrap.html'>rescaled.bootstrap</a>.
Afterwards the bootstrap replicates for each household are carried forward from the first period the household enters the survey to all the censecutive periods it stays in the survey.<br />
This ensures that the bootstrap replicates follow the same logic as the sampled households, making the bootstrap replicates more comparable to the actual sample units.<br /></p>
<p>If <code>split</code> ist set to <code>TRUE</code> and <code>pid</code> is specified, the bootstrap replicates are carried forward using the personal identifiers instead of the houshold identifier.
This takes into account the issue of a houshold splitting up.
Any person in this new split household will get the same bootstrap replicate as the person that has come from an other household in the survey.
People who enter already existing households will also get the same bootstrap replicate as the other households members had in the previous periods.</p>
    
    <h2 class="hasAnchor" id="see-also"><a class="anchor" href="#see-also"></a>See also</h2>

    <div class='dont-index'><p><code><a href='http://www.rdocumentation.org/packages/data.table/topics/data.table'>data.table</a></code> for more information on data.table objects.</p></div>
    

    <h2 class="hasAnchor" id="examples"><a class="anchor" href="#examples"></a>Examples</h2>
    <pre class="examples"><span class='co'># NOT RUN {</span>
<span class='no'>eusilc</span> <span class='kw'>&lt;-</span> <span class='fu'><a href='demo.eusilc.html'>demo.eusilc</a></span>(<span class='kw'>prettyNames</span> <span class='kw'>=</span> <span class='fl'>TRUE</span>)

<span class='no'>dat_boot</span> <span class='kw'>&lt;-</span> <span class='fu'>draw.bootstrap</span>(<span class='no'>eusilc</span>, <span class='kw'>REP</span> <span class='kw'>=</span> <span class='fl'>10</span>, <span class='kw'>hid</span> <span class='kw'>=</span> <span class='st'>"hid"</span>, <span class='kw'>weights</span> <span class='kw'>=</span> <span class='st'>"pWeight"</span>,
                           <span class='kw'>strata</span> <span class='kw'>=</span> <span class='st'>"region"</span>, <span class='kw'>period</span><span class='kw'>=</span><span class='st'>"year"</span>)

<span class='no'>dat_boot</span> <span class='kw'>&lt;-</span> <span class='fu'>draw.bootstrap</span>(<span class='no'>eusilc</span>, <span class='kw'>REP</span> <span class='kw'>=</span> <span class='fl'>10</span>, <span class='kw'>hid</span> <span class='kw'>=</span> <span class='st'>"hid"</span>, <span class='kw'>weights</span> <span class='kw'>=</span> <span class='st'>"pWeight"</span>,
                           <span class='kw'>strata</span> <span class='kw'>=</span> <span class='fu'>c</span>(<span class='st'>"region"</span>, <span class='st'>"age"</span>), <span class='kw'>period</span> <span class='kw'>=</span> <span class='st'>"year"</span>)



<span class='co'># create spit households</span>
<span class='no'>eusilc</span>[, <span class='no'>pidsplit</span> <span class='kw'>:=</span> <span class='no'>pid</span>]
<span class='no'>year</span> <span class='kw'>&lt;-</span> <span class='no'>eusilc</span>[, <span class='fu'>unique</span>(<span class='no'>year</span>)]
<span class='no'>year</span> <span class='kw'>&lt;-</span> <span class='no'>year</span>[-<span class='fl'>1</span>]
<span class='no'>leaf_out</span> <span class='kw'>&lt;-</span> <span class='fu'>c</span>()
<span class='kw'>for</span>(<span class='no'>y</span> <span class='kw'>in</span> <span class='no'>year</span>){
  <span class='no'>split.person</span> <span class='kw'>&lt;-</span> <span class='no'>eusilc</span>[<span class='no'>year</span> <span class='kw'>==</span> (<span class='no'>y</span>-<span class='fl'>1</span>) <span class='kw'>&amp;</span> !<span class='fu'>duplicated</span>(<span class='no'>hid</span>) <span class='kw'>&amp;</span> !(<span class='no'>hid</span> <span class='kw'>%in%</span> <span class='no'>leaf_out</span>),
                         <span class='fu'>sample</span>(<span class='no'>pid</span>, <span class='fl'>20</span>)]
  <span class='no'>overwrite.person</span> <span class='kw'>&lt;-</span> <span class='no'>eusilc</span>[(<span class='no'>year</span> <span class='kw'>==</span> (<span class='no'>y</span>)) <span class='kw'>&amp;</span> !<span class='fu'>duplicated</span>(<span class='no'>hid</span>) <span class='kw'>&amp;</span> !(<span class='no'>hid</span> <span class='kw'>%in%</span> <span class='no'>leaf_out</span>),
                             <span class='fu'>.</span>(<span class='kw'>pid</span> <span class='kw'>=</span> <span class='fu'>sample</span>(<span class='no'>pid</span>, <span class='fl'>20</span>))]
  <span class='no'>overwrite.person</span>[, <span class='fu'>c</span>(<span class='st'>"pidsplit"</span>, <span class='st'>"year_curr"</span>) <span class='kw'>:=</span> <span class='fu'>.</span>(<span class='no'>split.person</span>, <span class='no'>y</span>)]

  <span class='no'>eusilc</span>[<span class='no'>overwrite.person</span>, <span class='no'>pidsplit</span> <span class='kw'>:=</span> <span class='no'>i.pidsplit</span>, <span class='kw'>on</span> <span class='kw'>=</span> <span class='fu'>.</span>(<span class='no'>pid</span>, <span class='no'>year</span> <span class='kw'>&gt;=</span> <span class='no'>year_curr</span>)]
  <span class='no'>leaf_out</span> <span class='kw'>&lt;-</span> <span class='fu'>c</span>(<span class='no'>leaf_out</span>,
                <span class='no'>eusilc</span>[<span class='no'>pid</span> <span class='kw'>%in%</span> <span class='fu'>c</span>(<span class='no'>overwrite.person</span>$<span class='no'>pid</span>, <span class='no'>overwrite.person</span>$<span class='no'>pidsplit</span>),
                <span class='fu'>unique</span>(<span class='no'>hid</span>)])
}

<span class='no'>dat_boot</span> <span class='kw'>&lt;-</span> <span class='fu'>draw.bootstrap</span>(<span class='no'>eusilc</span>, <span class='kw'>REP</span> <span class='kw'>=</span> <span class='fl'>10</span>, <span class='kw'>hid</span> <span class='kw'>=</span> <span class='st'>"hid"</span>, <span class='kw'>weights</span> <span class='kw'>=</span> <span class='st'>"pWeight"</span>,
                           <span class='kw'>strata</span> <span class='kw'>=</span> <span class='fu'>c</span>(<span class='st'>"region"</span>, <span class='st'>"age"</span>), <span class='kw'>period</span> <span class='kw'>=</span> <span class='st'>"year"</span>, <span class='kw'>split</span> <span class='kw'>=</span> <span class='fl'>TRUE</span>,
                           <span class='kw'>pid</span> <span class='kw'>=</span> <span class='st'>"pidsplit"</span>)
<span class='co'># split households were considered e.g. household and</span>
<span class='co'># split household were both selected or not selected</span>
<span class='no'>dat_boot</span>[, <span class='kw pkg'>data.table</span><span class='kw ns'>::</span><span class='fu'><a href='http://www.rdocumentation.org/packages/data.table/topics/duplicated'>uniqueN</a></span>(<span class='no'>w1</span>), <span class='kw'>by</span> <span class='kw'>=</span> <span class='no'>pidsplit</span>][<span class='no'>V1</span> <span class='kw'>&gt;</span> <span class='fl'>1</span>]
<span class='co'># }</span><div class='input'>
</div></pre>
  </div>
  <div class="col-md-3 hidden-xs hidden-sm" id="sidebar">
    <h2>Contents</h2>
    <ul class="nav nav-pills nav-stacked">
      <li><a href="#arguments">Arguments</a></li>
      
      <li><a href="#value">Value</a></li>

      <li><a href="#details">Details</a></li>

      <li><a href="#see-also">See also</a></li>
      
      <li><a href="#examples">Examples</a></li>
    </ul>

    <h2>Author</h2>
    
Johannes Gussenbauer, Alexander Kowarik, Statistics Austria

  </div>
</div>

      <footer>
      <div class="copyright">
  <p>Developed by Johannes Gussenbauer, Alexander Kowarik, Gregor de Cillia.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="http://pkgdown.r-lib.org/">pkgdown</a>.</p>
</div>

      </footer>
   </div>

  

  </body>
</html>

