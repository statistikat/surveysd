<!-- Generated by pkgdown: do not edit by hand -->
<!DOCTYPE html>
<html lang="en">
  <head>
  <meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<title>Calcualte point estimates and their standard errors using bootstrap weights. — calc.stError • surveysd</title>

<link rel="shortcut icon" type="image/x-icon" href="../favicon.ico">

<!-- jquery -->
<script src="https://code.jquery.com/jquery-3.1.0.min.js" integrity="sha384-nrOSfDHtoPMzJHjVTdCopGqIqeYETSXhZDFyniQ8ZHcVy08QesyHcnOUpMpqnmWq" crossorigin="anonymous"></script>
<!-- Bootstrap -->
<link href="https://maxcdn.bootstrapcdn.com/bootswatch/3.3.7/cosmo/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous">

<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa" crossorigin="anonymous"></script>

<!-- Font Awesome icons -->
<link href="https://maxcdn.bootstrapcdn.com/font-awesome/4.6.3/css/font-awesome.min.css" rel="stylesheet" integrity="sha384-T8Gy5hrqNKT+hzMclPo118YTQO6cYprQmhrYwIiQ/3axmI1hQomh7Ud2hPOy8SP1" crossorigin="anonymous">

<!-- clipboard.js -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/1.7.1/clipboard.min.js" integrity="sha384-cV+rhyOuRHc9Ub/91rihWcGmMmCXDeksTtCihMupQHSsi8GIIRDG0ThDc3HGQFJ3" crossorigin="anonymous"></script>

<!-- sticky kit -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/sticky-kit/1.1.3/sticky-kit.min.js" integrity="sha256-c4Rlo1ZozqTPE2RLuvbusY3+SU1pQaJC0TjuhygMipw=" crossorigin="anonymous"></script>

<!-- pkgdown -->
<link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script>



<meta property="og:title" content="Calcualte point estimates and their standard errors using bootstrap weights. — calc.stError" />

<meta property="og:description" content="Calculate point estimates as well as standard errors of variables in surveys. Standard errors are estimated using bootstrap weights (see draw.bootstrap and recalib).
In addition the standard error of an estimate can be calcualted using the survey data for 3 or more consecutive periods, which results in a reduction of the standard error." />

<meta property="og:image" content="/logo.png" />
<meta name="twitter:card" content="summary" />



<!-- mathjax -->
<script src='https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js?config=TeX-AMS-MML_HTMLorMML'></script>

<!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->


  </head>

  <body>
    <div class="container template-reference-topic">
      <header>
      <div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">surveysd</a>
        <span class="label label-danger" data-toggle="tooltip" data-placement="bottom" title="Unreleased version">0.2.0</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        <li>
  <a href="../index.html">
    <span class="fa fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li>
      <a href="../articles/Methodology.html">Methodology</a>
    </li>
  </ul>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul>
      
      <ul class="nav navbar-nav navbar-right">
        <li>
  <a href="https://github.com/statistikat/surveysd">
    <span class="fa fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
      
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

      
      </header>

<div class="row">
  <div class="col-md-9 contents">
    <div class="page-header">
    <h1>Calcualte point estimates and their standard errors using bootstrap weights.</h1>
    <small class="dont-index">Source: <a href='https://github.com/statistikat/surveysd/blob/master/R/calc.stError.R'><code>R/calc.stError.R</code></a></small>
    <div class="hidden name"><code>calc.stError.Rd</code></div>
    </div>

    <div class="ref-description">
    
    <p>Calculate point estimates as well as standard errors of variables in surveys. Standard errors are estimated using bootstrap weights (see <a href='draw.bootstrap.html'>draw.bootstrap</a> and <a href='recalib.html'>recalib</a>).
In addition the standard error of an estimate can be calcualted using the survey data for 3 or more consecutive periods, which results in a reduction of the standard error.</p>
    
    </div>

    <pre class="usage"><span class='fu'>calc.stError</span>(<span class='no'>dat</span>, <span class='kw'>weights</span> <span class='kw'>=</span> <span class='fu'>attr</span>(<span class='no'>dat</span>, <span class='st'>"weights"</span>), <span class='kw'>b.weights</span> <span class='kw'>=</span> <span class='fu'>attr</span>(<span class='no'>dat</span>,
  <span class='st'>"b.rep"</span>), <span class='kw'>period</span> <span class='kw'>=</span> <span class='fu'>attr</span>(<span class='no'>dat</span>, <span class='st'>"period"</span>), <span class='no'>var</span>, <span class='kw'>fun</span> <span class='kw'>=</span> <span class='no'>weightedRatio</span>,
  <span class='kw'>national</span> <span class='kw'>=</span> <span class='fl'>FALSE</span>, <span class='kw'>group</span> <span class='kw'>=</span> <span class='kw'>NULL</span>, <span class='kw'>fun.adjust.var</span> <span class='kw'>=</span> <span class='kw'>NULL</span>,
  <span class='kw'>adjust.var</span> <span class='kw'>=</span> <span class='kw'>NULL</span>, <span class='kw'>period.diff</span> <span class='kw'>=</span> <span class='kw'>NULL</span>, <span class='kw'>period.mean</span> <span class='kw'>=</span> <span class='fl'>3</span>,
  <span class='kw'>bias</span> <span class='kw'>=</span> <span class='fl'>FALSE</span>, <span class='kw'>size.limit</span> <span class='kw'>=</span> <span class='fl'>20</span>, <span class='kw'>cv.limit</span> <span class='kw'>=</span> <span class='fl'>10</span>, <span class='kw'>p</span> <span class='kw'>=</span> <span class='kw'>NULL</span>, <span class='no'>...</span>)</pre>
    
    <h2 class="hasAnchor" id="arguments"><a class="anchor" href="#arguments"></a>Arguments</h2>
    <table class="ref-arguments">
    <colgroup><col class="name" /><col class="desc" /></colgroup>
    <tr>
      <th>dat</th>
      <td><p>either data.frame or data.table containing the survey data. Surveys can be a panel survey or rotating panel survey, but does not need to be. For rotating panel survey bootstrap weights can be created using <a href='draw.bootstrap.html'>draw.bootstrap</a> and <a href='recalib.html'>recalib</a>.</p></td>
    </tr>
    <tr>
      <th>weights</th>
      <td><p>character specifying the name of the column in <code>dat</code> containing the original sample weights. Used to calculate point estimates.</p></td>
    </tr>
    <tr>
      <th>b.weights</th>
      <td><p>character vector specifying the names of the columns in <code>dat</code> containing bootstrap weights. Used to calculate standard errors.</p></td>
    </tr>
    <tr>
      <th>period</th>
      <td><p>character specifying the name of the column in <code>dat</code> containing the sample periods.</p></td>
    </tr>
    <tr>
      <th>var</th>
      <td><p>character vector containing variable names in <code>dat</code> on which <code>fun</code> shall be applied for each sample period.</p></td>
    </tr>
    <tr>
      <th>fun</th>
      <td><p>function which will be applied on <code>var</code> for each sample period.
Predefined functions are <code>weightedRatio,weightedSum</code>, but can also take any other function which returns a double or integer and uses weights as its second argument.</p></td>
    </tr>
    <tr>
      <th>national</th>
      <td><p>boolean, if TRUE point estimates resulting from fun will be divided by the point estimate at the national level.</p></td>
    </tr>
    <tr>
      <th>group</th>
      <td><p>character vectors or list of character vectors containig variables in <code>dat</code>. For each list entry <code>dat</code> will be split in subgroups according to the containing variables as well as <code>period</code>.
The pointestimates are then estimated for each subgroup seperately. If <code>group=NULL</code> the data will split into sample periods by default.</p></td>
    </tr>
    <tr>
      <th>fun.adjust.var</th>
      <td><p>can be either <code>NULL</code> or a function. This argument can be used to apply a function for each <code>period</code> and bootstrap weight to the data. The resulting estimates will be passed down to <code>fun</code>. See details for more explanations.</p></td>
    </tr>
    <tr>
      <th>adjust.var</th>
      <td><p>can be either <code>NULL</code> or a character specifying the first argument in <code>fun.adjust.var</code>.</p></td>
    </tr>
    <tr>
      <th>period.diff</th>
      <td><p>character vectors, defining periods for which the differences in the point estimate as well it's standard error is calculated. Each entry must have the form of <code>"period1 - period2"</code>. Can be NULL</p></td>
    </tr>
    <tr>
      <th>period.mean</th>
      <td><p>odd integer, defining the range of periods over which the sample mean of point estimates is additionally calcualted.</p></td>
    </tr>
    <tr>
      <th>bias</th>
      <td><p>boolean, if <code>TRUE</code> the sample mean over the point estimates of the bootstrap weights is returned.</p></td>
    </tr>
    <tr>
      <th>size.limit</th>
      <td><p>integer defining a lower bound on the number of observations on <code>dat</code> in each group defined by <code>period</code> and the entries in <code>group</code>.
Warnings are returned if the number of observations in a subgroup falls below <code>size.limit</code>. In addition the concerned groups are available in the function output.</p></td>
    </tr>
    <tr>
      <th>cv.limit</th>
      <td><p>non-negativ value defining a upper bound for the standard error in relation to the point estimate. If this relation exceed <code>cv.limit</code>, for a point estimate, they are flagged and available in the function output.</p></td>
    </tr>
    <tr>
      <th>p</th>
      <td><p>numeric vector containing values between 0 and 1. Defines which quantiles for the distribution of <code>var</code> are additionally estimated.</p></td>
    </tr>
    <tr>
      <th>...</th>
      <td><p>additional arguments which will be passed to fun.</p></td>
    </tr>
    </table>
    
    <h2 class="hasAnchor" id="value"><a class="anchor" href="#value"></a>Value</h2>

    <p>Returns a list containing:</p><ul>
<li><p><code>Estimates</code>: data.table containing period differences and/or k period averages for estimates of
<code>fun</code> applied to <code>var</code> as well as the corresponding standard errors, which are calculated using the bootstrap weights.
In addition the sample size, <code>n</code>, and poplutaion size for each group is added to the output.</p></li>
<li><p><code>smallGroups</code>: data.table containing groups for which the number of observation falls below <code>size.limit</code>.</p></li>
<li><p><code>cvHigh</code>: data.table containing a boolean variable which indicates for each estimate if the
estimated standard error exceeds <code>cv.limit</code>.</p></li>
<li><p><code>stEDecrease</code>: data.table indicating for each estimate the theoretical increase in sample size which is
gained when averaging over k periods. Only returned if <code>period.mean</code> is not <code>NULL</code>.</p></li>
</ul>

    
    <h2 class="hasAnchor" id="details"><a class="anchor" href="#details"></a>Details</h2>

    <p><code>calc.stError</code> takes survey data (<code>dat</code>) and returns point estimates as well as their standard Errors
defined by <code>fun</code> and <code>var</code> for each sample period in <code>dat</code>.
<code>dat</code> must be household data where household members correspond to multiple rows with the same household identifier.
The data should at least containt the following columns:</p><ul>
<li><p>Column indicating the sample period;</p></li>
<li><p>Column indicating the household ID;</p></li>
<li><p>Column containing the household sample weights;</p></li>
<li><p>Columns which contain the bootstrap weights (see output of <a href='recalib.html'>recalib</a>);</p></li>
<li><p>Columns listed in <code>var</code> as well as in <code>group</code></p></li>
</ul>
    <p>For each variable in <code>var</code> as well as sample period the function <code>fun</code> is applied using the original as well as the bootstrap sample weights.<br />
The point estimate is then selected as the result of <code>fun</code> when using the original sample weights and it's standard error is estimated with the result of <code>fun</code> using the bootstrap sample weights. <br />
<br />
<code>fun</code> can be any function which returns a double or integer and uses sample weights as it's second argument. The predifined options are <code>weightedRatio</code> and <code>weightedSum</code>.<br />
<br />
For the option <code>weightedRatio</code> a weighted ratio (in %) of <code>var</code> is calculated for <code>var</code> equal to 1, e.g <code>sum(weight[var==1])/sum(weight[!is.na(var)])*100</code>.<br />
Additionally using the option <code>national=TRUE</code> the weighted ratio (in %) is divided by the weighted ratio at the national level for each <code>period</code>.
<br />
If <code>group</code> is not <code>NULL</code> but a vector of variables from <code>dat</code> then <code>fun</code> is applied on each subset of <code>dat</code> defined by all combinations of values in <code>group</code>.<br />
For instance if <code>group = "sex"</code> with "sex" having the values "Male" and "Female" in <code>dat</code> the point estimate and standard error is calculated on the subsets of <code>dat</code> with only "Male" or "Female" value for "sex". This is done for each value of <code>period</code>.
For variables in <code>group</code> which have <code>NA</code>s in <code>dat</code> the rows containing the missings will be discarded. <br />
When <code>group</code> is a list of character vectors, subsets of <code>dat</code> and the following estimation of the point estimate, including the estimate for the standard error, are calculated for each list entry.<br />
<br />
The optional parameters <code>fun.adjust.var</code> and <code>adjust.var</code> can be used if the values in <code>var</code> are dependent on the <code>weights</code>. As is for instance the case for the poverty thershhold calculated from EU-SILC.
In such a case an additional function can be supplied using <code>fun.adjust.var</code> as well as its first argument <code>adjust.var</code>, which needs to be part of the data set <code>dat</code>. Then, before applying <code>fun</code> on variable <code>var</code>
for all <code>period</code> and groups, the function <code>fun.adjust.var</code> is applied to <code>adjust.var</code> using each of the bootstrap weights seperately (NOTE: weight is used as the second argument of <code>fun.adjust.var</code>).
Thus creating i=1,...,<code>length(b.weights)</code> additional variables.
For applying <code>fun</code> on <code>var</code> the estimates for the bootstrap replicate will now use each of the corresponding new additional variables. So instead of
$$fun(var,weights,...),fun(var,b.weights[1],...),fun(var,b.weights[2],...),...$$
the function <code>fun</code> will be applied in the way
$$fun(var,weights,...),fun(var.1,b.weights[1],...),fun(var.2,b.weights[2],...),...$$</p>
<p>where <code>var.1</code>, <code>var.2</code>, <code>...</code> correspond to the estimates resulting from <code>fun.adjust.var</code> and <code>adjust.var</code>.
NOTE: This procedure is especially usefull if the <code>var</code> is dependent on <code>weights</code> and <code>fun</code> is applied on subgroups of the data set. Then it is not possible to capture this
procedure with <code>fun</code> and <code>var</code>, see examples for a more hands on explanation.
<br />
When defining <code>period.diff</code> the difference of point estimates between periods as well their standard errors are calculated.<br />
The entries in <code>period.diff</code> must have the form of <code>"period1 - period2"</code> which means that the results of the point estimates for <code>period2</code> will be substracted from the results of the point estimates for <code>period1</code>.<br />
<br />
Specifying <code>period.mean</code> leads to an improvement in standard error by averaging the results for the point estimates, using the bootstrap weights, over <code>period.mean</code> periods.
Setting, for instance, <code>period.mean = 3</code> the results in averaging these results over each consecutive set of 3 periods.<br />
Estimating the standard error over these averages gives an improved estimate of the standard error for the central period, which was used for averaging.<br />
The averaging of the results is also applied in differences of point estimates. For instance defining <code>period.diff = "2015-2009"</code> and <code>period.mean = 3</code>
the differences in point estimates of 2015 and 2009, 2016 and 2010 as well as 2017 and 2011 are calcualated and finally the average over these 3 differences is calculated.
The periods set in <code>period.diff</code> are always used as starting periods from which <code>period.mean-1</code> consecutive periods are used to build the average.
<br />
Setting <code>bias</code> to <code>TRUE</code> returns the calculation of a mean over the results from the bootstrap replicates. In  the output the corresponding columns is labeled <em>_mean</em> at the end.<br />
<br />
If <code>fun</code> needs more arguments they can be supplied in <code>...</code><br />
<br />
The parameter <code>size.limit</code> indicates a lower bound of the sample size for subsets in <code>dat</code> created by <code>group</code>. If the sample size of a subset falls below <code>size.limit</code> a warning will be displayed.<br />
In addition all subsets for which this is the case can be selected from the output of <code>calc.stError</code> with <code>$smallGroups</code>.<br />
With the parameter <code>cv.limit</code> one can set an upper bound on the coefficient of variantion. Estimates which exceed this bound are flagged with <code>TRUE</code> and are available in the function output with <code>$cvHigh</code>.
<code>cv.limit</code> must be a positive integer and is treated internally as %, e.g. for <code>cv.limit=1</code> the estimate will be flagged if the coefficient of variantion exceeds 1%.<br />
<br />
When specifying <code>period.mean</code>, the decrease in standard error for choosing this method is internally calcualted and a rough estimate for an implied increase in sample size is available in the output with <code>$stEDecrease</code>.
The rough estimate for the increase in sample size uses the fact that for a sample of size \(n\) the sample estimate for the standard error of most point estimates converges with a factor \(1/\sqrt{n}\) against the true standard error \(\sigma\).</p>
    
    <h2 class="hasAnchor" id="see-also"><a class="anchor" href="#see-also"></a>See also</h2>

    <div class='dont-index'><p><a href='draw.bootstrap.html'>draw.bootstrap</a> <br />
<a href='recalib.html'>recalib</a></p></div>
    

    <h2 class="hasAnchor" id="examples"><a class="anchor" href="#examples"></a>Examples</h2>
    <pre class="examples"><div class='input'><span class='co'># Import data and calibrate</span>

<span class='fu'>set.seed</span>(<span class='fl'>1234</span>)
<span class='no'>eusilc</span> <span class='kw'>&lt;-</span> <span class='fu'><a href='demo.eusilc.html'>demo.eusilc</a></span>(<span class='kw'>prettyNames</span> <span class='kw'>=</span> <span class='fl'>TRUE</span>)
<span class='no'>dat_boot</span> <span class='kw'>&lt;-</span> <span class='fu'><a href='draw.bootstrap.html'>draw.bootstrap</a></span>(<span class='no'>eusilc</span>, <span class='kw'>REP</span> <span class='kw'>=</span> <span class='fl'>10</span>, <span class='kw'>hid</span> <span class='kw'>=</span> <span class='st'>"hid"</span>, <span class='kw'>weights</span> <span class='kw'>=</span> <span class='st'>"pWeight"</span>,
                           <span class='kw'>strata</span> <span class='kw'>=</span> <span class='st'>"region"</span>, <span class='kw'>period</span> <span class='kw'>=</span> <span class='st'>"year"</span>)
<span class='no'>dat_boot_calib</span> <span class='kw'>&lt;-</span> <span class='fu'><a href='recalib.html'>recalib</a></span>(<span class='no'>dat_boot</span>, <span class='kw'>conP.var</span> <span class='kw'>=</span> <span class='st'>"gender"</span>, <span class='kw'>conH.var</span> <span class='kw'>=</span> <span class='st'>"region"</span>)</div><div class='output co'>#&gt; Convergence reached in  3  steps 
#&gt; Convergence reached in  3  steps 
#&gt; Convergence reached in  3  steps 
#&gt; Convergence reached in  3  steps 
#&gt; Convergence reached in  3  steps 
#&gt; Convergence reached in  3  steps 
#&gt; Convergence reached in  2  steps 
#&gt; Convergence reached in  3  steps 
#&gt; Convergence reached in  2  steps 
#&gt; Convergence reached in  4  steps </div><div class='input'>
<span class='co'># estimate weightedRatio for povertyRisk per period</span>

<span class='no'>err.est</span> <span class='kw'>&lt;-</span> <span class='fu'>calc.stError</span>(<span class='no'>dat_boot_calib</span>, <span class='kw'>var</span> <span class='kw'>=</span> <span class='st'>"povertyRisk"</span>, <span class='kw'>fun</span> <span class='kw'>=</span> <span class='no'>weightedRatio</span>,
                        <span class='kw'>period.mean</span> <span class='kw'>=</span> <span class='kw'>NULL</span>)
<span class='no'>err.est</span>$<span class='no'>Estimates</span></div><div class='output co'>#&gt;    year     n       N val_povertyRisk stE_povertyRisk
#&gt; 1: 2010 14827 8182222        14.44422       0.4688685
#&gt; 2: 2011 14827 8182222        14.60155       0.4024223
#&gt; 3: 2012 14827 8182222        15.24983       0.4220349
#&gt; 4: 2013 14827 8182222        15.60219       0.4683628
#&gt; 5: 2014 14827 8182222        15.57112       0.4106918
#&gt; 6: 2015 14827 8182222        15.59373       0.2814149
#&gt; 7: 2016 14827 8182222        15.69460       0.3654845
#&gt; 8: 2017 14827 8182222        15.81567       0.2807620</div><div class='input'>
<span class='co'># calculate weightedRatio for povertyRisk and fraction of one-person households per period</span>

<span class='no'>err.est</span> <span class='kw'>&lt;-</span> <span class='fu'>calc.stError</span>(<span class='no'>dat_boot_calib</span>, <span class='kw'>var</span> <span class='kw'>=</span> <span class='fu'>c</span>(<span class='st'>"povertyRisk"</span>, <span class='st'>"onePerson"</span>), <span class='kw'>fun</span> <span class='kw'>=</span> <span class='no'>weightedRatio</span>,
                        <span class='kw'>period.mean</span> <span class='kw'>=</span> <span class='kw'>NULL</span>)
<span class='no'>err.est</span>$<span class='no'>Estimates</span></div><div class='output co'>#&gt;    year     n       N val_povertyRisk stE_povertyRisk val_onePerson
#&gt; 1: 2010 14827 8182222        14.44422       0.4688685      42.83855
#&gt; 2: 2011 14827 8182222        14.60155       0.4024223      42.83855
#&gt; 3: 2012 14827 8182222        15.24983       0.4220349      42.83855
#&gt; 4: 2013 14827 8182222        15.60219       0.4683628      42.83855
#&gt; 5: 2014 14827 8182222        15.57112       0.4106918      42.83855
#&gt; 6: 2015 14827 8182222        15.59373       0.2814149      42.83855
#&gt; 7: 2016 14827 8182222        15.69460       0.3654845      42.83855
#&gt; 8: 2017 14827 8182222        15.81567       0.2807620      42.83855
#&gt;    stE_onePerson
#&gt; 1:     0.3298943
#&gt; 2:     0.3804563
#&gt; 3:     0.4304860
#&gt; 4:     0.3068252
#&gt; 5:     0.3273890
#&gt; 6:     0.2886085
#&gt; 7:     0.1833664
#&gt; 8:     0.2193366</div><div class='input'>
<span class='co'># estimate weightedRatio for povertyRisk per period and gender</span>

<span class='no'>group</span> <span class='kw'>&lt;-</span> <span class='st'>"gender"</span>
<span class='no'>err.est</span> <span class='kw'>&lt;-</span> <span class='fu'>calc.stError</span>(<span class='no'>dat_boot_calib</span>, <span class='kw'>var</span> <span class='kw'>=</span> <span class='st'>"povertyRisk"</span>, <span class='kw'>fun</span> <span class='kw'>=</span> <span class='no'>weightedRatio</span>,
                        <span class='kw'>group</span> <span class='kw'>=</span> <span class='no'>group</span>, <span class='kw'>period.mean</span> <span class='kw'>=</span> <span class='kw'>NULL</span>)
<span class='no'>err.est</span>$<span class='no'>Estimates</span></div><div class='output co'>#&gt;     year     n       N gender val_povertyRisk stE_povertyRisk
#&gt;  1: 2010  7267 3979572   male        12.02660       0.5997306
#&gt;  2: 2010  7560 4202650 female        16.73351       0.4032427
#&gt;  3: 2010 14827 8182222   &lt;NA&gt;        14.44422       0.4688685
#&gt;  4: 2011  7267 3979572   male        12.68746       0.4986765
#&gt;  5: 2011  7560 4202650 female        16.41404       0.4810301
#&gt;  6: 2011 14827 8182222   &lt;NA&gt;        14.60155       0.4024223
#&gt;  7: 2012  7267 3979572   male        13.97794       0.3873178
#&gt;  8: 2012  7560 4202650 female        16.45421       0.5427457
#&gt;  9: 2012 14827 8182222   &lt;NA&gt;        15.24983       0.4220349
#&gt; 10: 2013  7267 3979572   male        14.74218       0.4995886
#&gt; 11: 2013  7560 4202650 female        16.41655       0.6229487
#&gt; 12: 2013 14827 8182222   &lt;NA&gt;        15.60219       0.4683628
#&gt; 13: 2014  7267 3979572   male        15.12909       0.3051300
#&gt; 14: 2014  7560 4202650 female        15.98968       0.5881667
#&gt; 15: 2014 14827 8182222   &lt;NA&gt;        15.57112       0.4106918
#&gt; 16: 2015  7267 3979572   male        15.32805       0.3232729
#&gt; 17: 2015  7560 4202650 female        15.84530       0.4616858
#&gt; 18: 2015 14827 8182222   &lt;NA&gt;        15.59373       0.2814149
#&gt; 19: 2016  7267 3979572   male        15.40154       0.3246719
#&gt; 20: 2016  7560 4202650 female        15.97211       0.5442239
#&gt; 21: 2016 14827 8182222   &lt;NA&gt;        15.69460       0.3654845
#&gt; 22: 2017  7267 3979572   male        15.63907       0.2682385
#&gt; 23: 2017  7560 4202650 female        15.98289       0.4469988
#&gt; 24: 2017 14827 8182222   &lt;NA&gt;        15.81567       0.2807620
#&gt;     year     n       N gender val_povertyRisk stE_povertyRisk</div><div class='input'>
<span class='co'># estimate weightedRatio for povertyRisk per period and gender, region and combination of both</span>

<span class='no'>group</span> <span class='kw'>&lt;-</span> <span class='fu'>list</span>(<span class='st'>"gender"</span>, <span class='st'>"region"</span>, <span class='fu'>c</span>(<span class='st'>"gender"</span>, <span class='st'>"region"</span>))
<span class='no'>err.est</span> <span class='kw'>&lt;-</span> <span class='fu'>calc.stError</span>(<span class='no'>dat_boot_calib</span>, <span class='kw'>var</span> <span class='kw'>=</span> <span class='st'>"povertyRisk"</span>, <span class='kw'>fun</span> <span class='kw'>=</span> <span class='no'>weightedRatio</span>,
                        <span class='kw'>group</span> <span class='kw'>=</span> <span class='no'>group</span>, <span class='kw'>period.mean</span> <span class='kw'>=</span> <span class='kw'>NULL</span>)
<span class='no'>err.est</span>$<span class='no'>Estimates</span></div><div class='output co'>#&gt;      year     n         N gender        region val_povertyRisk stE_povertyRisk
#&gt;   1: 2010   261  122741.8   male    Burgenland       17.414524       3.2690518
#&gt;   2: 2010   288  137822.2 female    Burgenland       21.432598       3.2269725
#&gt;   3: 2010   359  182732.9   male    Vorarlberg       12.973259       2.3054104
#&gt;   4: 2010   374  194622.1 female    Vorarlberg       19.883637       3.3381588
#&gt;   5: 2010   440  253143.7   male      Salzburg        9.156964       0.7703249
#&gt;  ---                                                                          
#&gt; 236: 2017  2804 1555709.0   &lt;NA&gt; Lower Austria       15.309413       0.8187684
#&gt; 237: 2017  2805 1421620.0   &lt;NA&gt; Upper Austria       16.488307       0.9339446
#&gt; 238: 2017  7267 3979571.7   male          &lt;NA&gt;       15.639072       0.2682385
#&gt; 239: 2017  7560 4202650.3 female          &lt;NA&gt;       15.982891       0.4469988
#&gt; 240: 2017 14827 8182222.0   &lt;NA&gt;          &lt;NA&gt;       15.815668       0.2807620</div><div class='input'>
<span class='co'># use average over 3 periods for standard error estimation</span>

<span class='no'>err.est</span> <span class='kw'>&lt;-</span> <span class='fu'>calc.stError</span>(<span class='no'>dat_boot_calib</span>, <span class='kw'>var</span> <span class='kw'>=</span> <span class='st'>"povertyRisk"</span>, <span class='kw'>fun</span> <span class='kw'>=</span> <span class='no'>weightedRatio</span>, <span class='kw'>period.mean</span> <span class='kw'>=</span> <span class='fl'>3</span>)
<span class='no'>err.est</span>$<span class='no'>Estimates</span></div><div class='output co'>#&gt;               year     n       N val_povertyRisk stE_povertyRisk
#&gt;  1:           2010 14827 8182222        14.44422       0.4688685
#&gt;  2: 2010_2011_2012 14827 8182222        14.76520       0.4003958
#&gt;  3:           2011 14827 8182222        14.60155       0.4024223
#&gt;  4: 2011_2012_2013 14827 8182222        15.15119       0.4088566
#&gt;  5:           2012 14827 8182222        15.24983       0.4220349
#&gt;  6: 2012_2013_2014 14827 8182222        15.47438       0.4010153
#&gt;  7:           2013 14827 8182222        15.60219       0.4683628
#&gt;  8: 2013_2014_2015 14827 8182222        15.58901       0.3654965
#&gt;  9:           2014 14827 8182222        15.57112       0.4106918
#&gt; 10: 2014_2015_2016 14827 8182222        15.61982       0.2957732
#&gt; 11:           2015 14827 8182222        15.59373       0.2814149
#&gt; 12: 2015_2016_2017 14827 8182222        15.70133       0.2462554
#&gt; 13:           2016 14827 8182222        15.69460       0.3654845
#&gt; 14:           2017 14827 8182222        15.81567       0.2807620</div><div class='input'>
<span class='co'># get estimate for difference of period 2016 and 2013</span>

<span class='no'>period.diff</span> <span class='kw'>&lt;-</span> <span class='fu'>c</span>(<span class='st'>"2015-2011"</span>)
<span class='no'>err.est</span> <span class='kw'>&lt;-</span> <span class='fu'>calc.stError</span>(<span class='no'>dat_boot_calib</span>, <span class='kw'>var</span> <span class='kw'>=</span> <span class='st'>"povertyRisk"</span>, <span class='kw'>fun</span> <span class='kw'>=</span> <span class='no'>weightedRatio</span>,
                        <span class='kw'>period.diff</span> <span class='kw'>=</span> <span class='no'>period.diff</span>, <span class='kw'>period.mean</span> <span class='kw'>=</span> <span class='fl'>3</span>)
<span class='no'>err.est</span>$<span class='no'>Estimates</span></div><div class='output co'>#&gt;               year     n       N val_povertyRisk stE_povertyRisk
#&gt;  1:           2010 14827 8182222      14.4442182       0.4688685
#&gt;  2: 2010_2011_2012 14827 8182222      14.7651989       0.4003958
#&gt;  3:           2011 14827 8182222      14.6015494       0.4024223
#&gt;  4: 2011_2012_2013 14827 8182222      15.1511909       0.4088566
#&gt;  5:           2012 14827 8182222      15.2498292       0.4220349
#&gt;  6: 2012_2013_2014 14827 8182222      15.4743806       0.4010153
#&gt;  7:           2013 14827 8182222      15.6021940       0.4683628
#&gt;  8: 2013_2014_2015 14827 8182222      15.5890130       0.3654965
#&gt;  9:           2014 14827 8182222      15.5711186       0.4106918
#&gt; 10: 2014_2015_2016 14827 8182222      15.6198163       0.2957732
#&gt; 11:           2015 14827 8182222      15.5937264       0.2814149
#&gt; 12:      2015-2011 14827 8182222       0.9921770       0.2571908
#&gt; 13: 2015_2016_2017 14827 8182222      15.7013328       0.2462554
#&gt; 14:           2016 14827 8182222      15.6946038       0.3654845
#&gt; 15: 2016-2012-mean 14827 8182222       0.8546173       0.2615226
#&gt; 16:           2017 14827 8182222      15.8156683       0.2807620</div><div class='input'>
<span class='co'># use a function from an other package that has sampling weights as its second argument</span>
<span class='co'># for example gini() from laeken</span>

<span class='fu'>library</span>(<span class='no'>laeken</span>)

<span class='co'>## set up help function that returns only the gini index</span>
<span class='no'>help_gini</span> <span class='kw'>&lt;-</span> <span class='kw'>function</span>(<span class='no'>x</span>, <span class='no'>w</span>){
 <span class='fu'>return</span>(<span class='fu'><a href='http://www.rdocumentation.org/packages/laeken/topics/gini'>gini</a></span>(<span class='no'>x</span>, <span class='no'>w</span>)$<span class='no'>value</span>)
}

<span class='co'>## make sure povertyRisk get coerced to a numeric in order to work with the external functions</span>
<span class='fu'>invisible</span>(<span class='no'>dat_boot_calib</span>[, <span class='no'>povertyRisk</span> <span class='kw'>:=</span> <span class='fu'>as.numeric</span>(<span class='no'>povertyRisk</span>)])

<span class='no'>err.est</span> <span class='kw'>&lt;-</span> <span class='fu'>calc.stError</span>(<span class='no'>dat_boot_calib</span>, <span class='kw'>var</span> <span class='kw'>=</span> <span class='st'>"povertyRisk"</span>, <span class='kw'>fun</span> <span class='kw'>=</span> <span class='no'>help_gini</span>, <span class='kw'>group</span> <span class='kw'>=</span> <span class='no'>group</span>,
                        <span class='kw'>period.diff</span> <span class='kw'>=</span> <span class='no'>period.diff</span>, <span class='kw'>period.mean</span> <span class='kw'>=</span> <span class='fl'>3</span>)
<span class='no'>err.est</span>$<span class='no'>Estimates</span></div><div class='output co'>#&gt;      year     n         N gender        region val_povertyRisk stE_povertyRisk
#&gt;   1: 2010   261  122741.8   male    Burgenland        82.58548       3.2690518
#&gt;   2: 2010   288  137822.2 female    Burgenland        78.56740       3.2269725
#&gt;   3: 2010   359  182732.9   male    Vorarlberg        87.02674       2.3054104
#&gt;   4: 2010   374  194622.1 female    Vorarlberg        80.11636       3.3381588
#&gt;   5: 2010   440  253143.7   male      Salzburg        90.84304       0.7703249
#&gt;  ---                                                                          
#&gt; 476: 2017  2804 1555709.0   &lt;NA&gt; Lower Austria        84.69059       0.8187684
#&gt; 477: 2017  2805 1421620.0   &lt;NA&gt; Upper Austria        83.51169       0.9339446
#&gt; 478: 2017  7267 3979571.7   male          &lt;NA&gt;        84.36093       0.2682385
#&gt; 479: 2017  7560 4202650.3 female          &lt;NA&gt;        84.01711       0.4469988
#&gt; 480: 2017 14827 8182222.0   &lt;NA&gt;          &lt;NA&gt;        84.18433       0.2807620</div><div class='input'>
<span class='co'># using fun.adjust.var and adjust.var to estimate povmd60 indicator</span>
<span class='co'># for each period and bootstrap weight before applying the weightedRatio point estimate</span>

<span class='co'># this function estimates the povmd60 indicator with x as income vector</span>
<span class='co'># and w as weight vector</span>
<span class='no'>povmd</span> <span class='kw'>&lt;-</span> <span class='kw'>function</span>(<span class='no'>x</span>, <span class='no'>w</span>){
 <span class='no'>md</span> <span class='kw'>&lt;-</span> <span class='kw pkg'>laeken</span><span class='kw ns'>::</span><span class='fu'><a href='http://www.rdocumentation.org/packages/laeken/topics/weightedMedian'>weightedMedian</a></span>(<span class='no'>x</span>, <span class='no'>w</span>)*<span class='fl'>0.6</span>
 <span class='no'>pmd60</span> <span class='kw'>&lt;-</span> <span class='no'>x</span> <span class='kw'>&lt;</span> <span class='no'>md</span>
 <span class='fu'>return</span>(<span class='fu'>as.integer</span>(<span class='no'>pmd60</span>))
}

<span class='co'># set adjust.var="eqIncome" so the income vector ist used to estimate</span>
<span class='co'># the povmd60 indicator for each bootstrap weight</span>
<span class='co'># and the resultung indicators are passed to function weightedRatio</span>

<span class='no'>err.est</span> <span class='kw'>&lt;-</span> <span class='fu'>calc.stError</span>(<span class='no'>dat_boot_calib</span>, <span class='kw'>var</span> <span class='kw'>=</span> <span class='st'>"povertyRisk"</span>, <span class='kw'>fun</span> <span class='kw'>=</span> <span class='no'>weightedRatio</span>,
                        <span class='kw'>group</span> <span class='kw'>=</span> <span class='no'>group</span>, <span class='kw'>fun.adjust.var</span> <span class='kw'>=</span> <span class='no'>povmd</span>, <span class='kw'>adjust.var</span> <span class='kw'>=</span> <span class='st'>"eqIncome"</span>)
<span class='no'>err.est</span>$<span class='no'>Estimates</span></div><div class='output co'>#&gt;      year     n         N gender        region val_povertyRisk stE_povertyRisk
#&gt;   1: 2010   261  122741.8   male    Burgenland       17.414524       3.2816388
#&gt;   2: 2010   288  137822.2 female    Burgenland       21.432598       3.3221745
#&gt;   3: 2010   359  182732.9   male    Vorarlberg       12.973259       2.3303400
#&gt;   4: 2010   374  194622.1 female    Vorarlberg       19.883637       3.4221804
#&gt;   5: 2010   440  253143.7   male      Salzburg        9.156964       0.7433869
#&gt;  ---                                                                          
#&gt; 416: 2017  2804 1555709.0   &lt;NA&gt; Lower Austria       15.309413       0.6725861
#&gt; 417: 2017  2805 1421620.0   &lt;NA&gt; Upper Austria       16.488307       0.8777592
#&gt; 418: 2017  7267 3979571.7   male          &lt;NA&gt;       15.639072       0.2926003
#&gt; 419: 2017  7560 4202650.3 female          &lt;NA&gt;       15.982891       0.5071975
#&gt; 420: 2017 14827 8182222.0   &lt;NA&gt;          &lt;NA&gt;       15.815668       0.3182340</div><div class='input'>
<span class='co'># why fun.adjust.var and adjust.var are needed (!!!):</span>
<span class='co'># one could also use the following function</span>
<span class='co'># and set fun.adjust.var=NULL,adjust.var=NULL</span>
<span class='co'># and set fun = povmd, var = "eqIncome"</span>

<span class='no'>povmd2</span> <span class='kw'>&lt;-</span> <span class='kw'>function</span>(<span class='no'>x</span>, <span class='no'>w</span>){
 <span class='no'>md</span> <span class='kw'>&lt;-</span> <span class='kw pkg'>laeken</span><span class='kw ns'>::</span><span class='fu'><a href='http://www.rdocumentation.org/packages/laeken/topics/weightedMedian'>weightedMedian</a></span>(<span class='no'>x</span>, <span class='no'>w</span>)*<span class='fl'>0.6</span>
 <span class='no'>pmd60</span> <span class='kw'>&lt;-</span> <span class='no'>x</span> <span class='kw'>&lt;</span> <span class='no'>md</span>
 <span class='co'># weighted ratio is directly estimated inside my function</span>
 <span class='fu'>return</span>(<span class='fu'>sum</span>(<span class='no'>w</span>[<span class='no'>pmd60</span>])/<span class='fu'>sum</span>(<span class='no'>w</span>)*<span class='fl'>100</span>)
}

<span class='co'># but this results in different results in subgroups</span>
<span class='co'># compared to using fun.adjust.var and adjust.var</span>

<span class='no'>err.est.different</span> <span class='kw'>&lt;-</span> <span class='fu'>calc.stError</span>(<span class='no'>dat_boot_calib</span>, <span class='kw'>var</span> <span class='kw'>=</span> <span class='st'>"eqIncome"</span>, <span class='kw'>fun</span> <span class='kw'>=</span> <span class='no'>povmd2</span>,
                                  <span class='kw'>group</span> <span class='kw'>=</span> <span class='no'>group</span>, <span class='kw'>fun.adjust.var</span> <span class='kw'>=</span> <span class='kw'>NULL</span>, <span class='kw'>adjust.var</span> <span class='kw'>=</span> <span class='kw'>NULL</span>)
<span class='no'>err.est.different</span>$<span class='no'>Estimates</span></div><div class='output co'>#&gt;      year     n         N gender        region val_eqIncome stE_eqIncome
#&gt;   1: 2010   261  122741.8   male    Burgenland     18.61871    3.1310902
#&gt;   2: 2010   288  137822.2 female    Burgenland     18.12804    3.9075838
#&gt;   3: 2010   359  182732.9   male    Vorarlberg     14.10553    2.4903233
#&gt;   4: 2010   374  194622.1 female    Vorarlberg     19.34374    2.0907274
#&gt;   5: 2010   440  253143.7   male      Salzburg     11.71768    1.1385204
#&gt;  ---                                                                    
#&gt; 416: 2017  2804 1555709.0   &lt;NA&gt; Lower Austria     15.67182    0.6327656
#&gt; 417: 2017  2805 1421620.0   &lt;NA&gt; Upper Austria     14.98835    1.0035044
#&gt; 418: 2017  7267 3979571.7   male          &lt;NA&gt;     16.18185    0.3382632
#&gt; 419: 2017  7560 4202650.3 female          &lt;NA&gt;     15.54953    0.4348831
#&gt; 420: 2017 14827 8182222.0   &lt;NA&gt;          &lt;NA&gt;     15.81567    0.3182340</div><div class='input'>
<span class='co'>## results are equal for yearly estimates</span>
<span class='fu'>all.equal</span>(<span class='no'>err.est.different</span>$<span class='no'>Estimates</span>[<span class='fu'>is.na</span>(<span class='no'>gender</span>) <span class='kw'>&amp;</span> <span class='fu'>is.na</span>(<span class='no'>region</span>)],
          <span class='no'>err.est</span>$<span class='no'>Estimates</span>[<span class='fu'>is.na</span>(<span class='no'>gender</span>)<span class='kw'>&amp;</span><span class='fu'>is.na</span>(<span class='no'>region</span>)],
          <span class='kw'>check.attributes</span> <span class='kw'>=</span> <span class='fl'>FALSE</span>)</div><div class='output co'>#&gt; [1] TRUE</div><div class='input'>
<span class='co'>## but for subgroups (gender, region) results vary</span>
<span class='fu'>all.equal</span>(<span class='no'>err.est.different</span>$<span class='no'>Estimates</span>[!(<span class='fu'>is.na</span>(<span class='no'>gender</span>) <span class='kw'>&amp;</span> <span class='fu'>is.na</span>(<span class='no'>region</span>))],
          <span class='no'>err.est</span>$<span class='no'>Estimates</span>[!(<span class='fu'>is.na</span>(<span class='no'>gender</span>) <span class='kw'>&amp;</span> <span class='fu'>is.na</span>(<span class='no'>region</span>))],
          <span class='kw'>check.attributes</span> <span class='kw'>=</span> <span class='fl'>FALSE</span>)</div><div class='output co'>#&gt; [1] "Column 'val_eqIncome': Mean relative difference: 0.07190565"</div><div class='input'>
</div></pre>
  </div>
  <div class="col-md-3 hidden-xs hidden-sm" id="sidebar">
    <h2>Contents</h2>
    <ul class="nav nav-pills nav-stacked">
      <li><a href="#arguments">Arguments</a></li>
      
      <li><a href="#value">Value</a></li>

      <li><a href="#details">Details</a></li>

      <li><a href="#see-also">See also</a></li>
      
      <li><a href="#examples">Examples</a></li>
    </ul>

    <h2>Author</h2>
    
Johannes Gussenbauer, Alexander Kowarik, Statistics Austria

  </div>
</div>

      <footer>
      <div class="copyright">
  <p>Developed by Johannes Gussenbauer, Alexander Kowarik, Gregor de Cillia.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="http://pkgdown.r-lib.org/">pkgdown</a>.</p>
</div>

      </footer>
   </div>

  

  </body>
</html>

