<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><title>Draw bootstrap replicates — draw.bootstrap • surveysd</title><!-- favicons --><link rel="icon" type="image/png" sizes="96x96" href="../favicon-96x96.png"><link rel="icon" type="”image/svg+xml”" href="../favicon.svg"><link rel="apple-touch-icon" sizes="180x180" href="../apple-touch-icon.png"><link rel="icon" sizes="any" href="../favicon.ico"><link rel="manifest" href="../site.webmanifest"><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet"><script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet"><link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet"><script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><link href="../extra.css" rel="stylesheet"><meta property="og:title" content="Draw bootstrap replicates — draw.bootstrap"><meta name="description" content="Draw bootstrap replicates from survey data with rotating panel
design. Survey information, like ID, sample weights, strata and population
totals per strata, should be specified to ensure meaningfull survey
bootstraping."><meta property="og:description" content="Draw bootstrap replicates from survey data with rotating panel
design. Survey information, like ID, sample weights, strata and population
totals per strata, should be specified to ensure meaningfull survey
bootstraping."><meta property="og:image" content="https://statistikat.github.io/surveysd/logo.png"></head><body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">surveysd</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="Released version">2.0.1</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto"><li class="nav-item"><a class="nav-link" href="../articles/surveysd.html">Get started</a></li>
<li class="active nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles"><li><a class="dropdown-item" href="../articles/error_estimation.html">Error estimation</a></li>
    <li><a class="dropdown-item" href="../articles/ipf.html">Iterative Proportional Fitting</a></li>
    <li><a class="dropdown-item" href="../articles/methodology.html">Methodology</a></li>
    <li><a class="dropdown-item" href="../articles/raowu.html">Rao-Wu Bootstrap in surveysd</a></li>
  </ul></li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
      </ul><ul class="navbar-nav"><li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json"></form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/statistikat/surveysd/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul></div>


  </div>
</nav><div class="container template-reference-topic">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.png" class="logo" alt=""><h1>Draw bootstrap replicates</h1>
      <small class="dont-index">Source: <a href="https://github.com/statistikat/surveysd/blob/2.0.0/R/draw.bootstrap.R" class="external-link"><code>R/draw.bootstrap.R</code></a></small>
      <div class="d-none name"><code>draw.bootstrap.Rd</code></div>
    </div>

    <div class="ref-description section level2">
    <p>Draw bootstrap replicates from survey data with rotating panel
design. Survey information, like ID, sample weights, strata and population
totals per strata, should be specified to ensure meaningfull survey
bootstraping.</p>
    </div>

    <div class="section level2">
    <h2 id="ref-usage">Usage<a class="anchor" aria-label="anchor" href="#ref-usage"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">draw.bootstrap</span><span class="op">(</span></span>
<span>  <span class="va">dat</span>,</span>
<span>  method <span class="op">=</span> <span class="st">"Preston"</span>,</span>
<span>  REP <span class="op">=</span> <span class="fl">1000</span>,</span>
<span>  hid <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  <span class="va">weights</span>,</span>
<span>  period <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  strata <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  cluster <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  totals <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  single.PSU <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"merge"</span>, <span class="st">"mean"</span><span class="op">)</span>,</span>
<span>  boot.names <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  split <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  pid <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  seed <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  already.selected <span class="op">=</span> <span class="cn">NULL</span></span>
<span><span class="op">)</span></span></code></pre></div>
    </div>

    <div class="section level2">
    <h2 id="arguments">Arguments<a class="anchor" aria-label="anchor" href="#arguments"></a></h2>


<dl><dt id="arg-dat">dat<a class="anchor" aria-label="anchor" href="#arg-dat"></a></dt>
<dd><p>either data.frame or data.table containing the survey data with
rotating panel design.</p></dd>


<dt id="arg-method">method<a class="anchor" aria-label="anchor" href="#arg-method"></a></dt>
<dd><p>for bootstrap replicates, either <code>"Preston"</code> or <code>"Rao-Wu"</code></p></dd>


<dt id="arg-rep">REP<a class="anchor" aria-label="anchor" href="#arg-rep"></a></dt>
<dd><p>integer indicating the number of bootstrap replicates.</p></dd>


<dt id="arg-hid">hid<a class="anchor" aria-label="anchor" href="#arg-hid"></a></dt>
<dd><p>character specifying the name of the column in <code>dat</code> containing
the household id. If <code>NULL</code> (the default), the household structure is not
regarded.</p></dd>


<dt id="arg-weights">weights<a class="anchor" aria-label="anchor" href="#arg-weights"></a></dt>
<dd><p>character specifying the name of the column in <code>dat</code>
containing the sample weights.</p></dd>


<dt id="arg-period">period<a class="anchor" aria-label="anchor" href="#arg-period"></a></dt>
<dd><p>character specifying the name of the column in <code>dat</code> containing
the sample periods. If <code>NULL</code> (the default), it is assumed that all
observations belong to the same period.</p></dd>


<dt id="arg-strata">strata<a class="anchor" aria-label="anchor" href="#arg-strata"></a></dt>
<dd><p>character vector specifying the name(s) of the column in <code>dat</code>
by which the population was stratified. If <code>strata</code> is a vector
stratification will be assumed as the combination of column names contained
in <code>strata</code>. Setting in addition <code>cluster</code> not NULL stratification will be
assumed on multiple stages, where each additional entry in <code>strata</code>
specifies the stratification variable for the next lower stage. see Details
for more information.</p></dd>


<dt id="arg-cluster">cluster<a class="anchor" aria-label="anchor" href="#arg-cluster"></a></dt>
<dd><p>character vector specifying cluster in the data. If not
already specified in <code>cluster</code> household ID is taken es the lowest level
cluster.</p></dd>


<dt id="arg-totals">totals<a class="anchor" aria-label="anchor" href="#arg-totals"></a></dt>
<dd><p>character specifying the name of the column in <code>dat</code> containing
the the totals per strata and/or cluster. Is ONLY optional if <code>cluster</code> is
<code>NULL</code> or equal <code>hid</code> and <code>strata</code> contains one columnname! Then the
households per strata will be calcualted using the <code>weights</code> argument. If
clusters and strata for multiple stages are specified <code>totals</code> needs to be
a vector of <code>length(strata)</code> specifying the column on <code>dat</code> that contain
the total number of PSUs at each stage. <code>totals</code> is interpreted from left
the right, meaning that the first argument corresponds to the number of
PSUs at the first and the last argument to the number of PSUs at the last
stage.</p></dd>


<dt id="arg-single-psu">single.PSU<a class="anchor" aria-label="anchor" href="#arg-single-psu"></a></dt>
<dd><p>either "merge" or "mean" defining how single PSUs need to
be dealt with. For <code>single.PSU="merge"</code> single PSUs at each stage are
merged with the strata or cluster with the next least number of PSUs. If
multiple of those exist one will be select via random draw. For
<code>single.PSU="mean"</code> single PSUs will get the mean over all bootstrap
replicates at the stage which did not contain single PSUs.</p></dd>


<dt id="arg-boot-names">boot.names<a class="anchor" aria-label="anchor" href="#arg-boot-names"></a></dt>
<dd><p>character indicating the leading string of the column names
for each bootstrap replica. If NULL defaults to "w".</p></dd>


<dt id="arg-split">split<a class="anchor" aria-label="anchor" href="#arg-split"></a></dt>
<dd><p>logical, if TRUE split households are considered using <code>pid</code>,
for more information see Details.</p></dd>


<dt id="arg-pid">pid<a class="anchor" aria-label="anchor" href="#arg-pid"></a></dt>
<dd><p>column in <code>dat</code> specifying the personal identifier. This
identifier needs to be unique for each person throught the whole data set.
Can be <code>NULL</code>.</p></dd>


<dt id="arg-seed">seed<a class="anchor" aria-label="anchor" href="#arg-seed"></a></dt>
<dd><p>integer specifying the seed for the random number generator.</p></dd>


<dt id="arg-already-selected">already.selected<a class="anchor" aria-label="anchor" href="#arg-already-selected"></a></dt>
<dd><p>list of data.tables indicating if record was drawn
in previous <code>period</code>. <code>length(already.selected)</code> must be equal to
the number of sampling stages specified. See <code><a href="get.selection.html">get.selection()</a></code> for an example.</p></dd>

</dl></div>
    <div class="section level2">
    <h2 id="value">Value<a class="anchor" aria-label="anchor" href="#value"></a></h2>
    <p>the survey data with the number of REP bootstrap replicates added as
columns.</p>
<p>Returns a data.table containing the original data as well as the
number of <code>REP</code> columns containing the bootstrap replicates for each
repetition.<br>
The columns of the bootstrap replicates are by default labeled "w<em>Number</em>"
where <em>Number</em> goes from 1 to <code>REP</code>. If the column names of the bootstrap
replicates should start with a different character or string the parameter
<code>boot.names</code> can be used.</p>
    </div>
    <div class="section level2">
    <h2 id="details">Details<a class="anchor" aria-label="anchor" href="#details"></a></h2>
    <p><code>draw.bootstrap</code> takes <code>dat</code> and draws <code>REP</code> bootstrap replicates
from it.
<code>dat</code> must be household data where household members correspond to multiple
rows with the same household
identifier. For most practical applications, the following columns should be
available in the dataset
and passed via the corresponding parameters:</p><ul><li><p>Column indicating the sample period (parameter <code>period</code>).</p></li>
<li><p>Column indicating the household ID (parameter <code>hid</code>)</p></li>
<li><p>Column containing the household sample weights (parameter <code>weights</code>);</p></li>
<li><p>Columns by which population was stratified during the sampling process
(parameter: <code>strata</code>).</p></li>
</ul><p>As methods either the either the rescaled bootstrap for stratified
multistage sampling, presented by J. Preston (2009) (<code>method = "Preston"</code>)
or the Rao-Wu boostrap by J. N. K. Rao and C. F. J. Wu (1988) (<code>method = "Rao-Wu"</code>)
are supported.
<br>
For single stage sampling design a column the argument <code>totals</code> is optional,
meaning that a column of the number of PSUs at the first stage does not need
to be supplied. The number of PSUs is calculated and added to <code>dat</code> using
<code>strata</code> and <code>weights</code>. By setting <code>cluster</code> to NULL single stage sampling
design is always assumed and
if <code>strata</code> contains of multiple column names the combination of all those
column names will be used for stratification.
<br>
In the case of multi stage sampling design the argument <code>totals</code> needs to be
specified and needs to have the same number of arguments as <code>strata</code>.
<br>
If <code>cluster</code> is <code>NULL</code> or does not contain <code>hid</code> at the last stage, <code>hid</code>
will automatically be used as the final cluster. If, besides <code>hid</code>,
clustering in additional stages is specified the number of column names in
<code>strata</code> and <code>cluster</code> (including <code>hid</code>) must be the same. If for any stage
there was no clustering or stratification one can set "1" or "I" for this
stage.
<br>
For example <code>strata=c("REGION","I"),cluster=c("MUNICIPALITY","HID")</code> would
speficy a 2 stage sampling design where at the first stage the municipalities
where drawn stratified by regions
and at the 2nd stage housholds are drawn in each municipality without
stratification.
<br>
Bootstrap replicates are drawn for each survey period consecutively (<code>period</code>) using the
function <a href="rescaled.bootstrap.html">rescaled.bootstrap</a>.
Bootstrap replicates are drawn consistently in the way that in each <code>period</code> and
sampling stage always \(\lfloor n/2 \rfloor\) clusters are selected in each strata.
<br>
This ensures that the bootstrap replicates follow the same logic as the
sampled households, making the bootstrap replicates more comparable to the
actual sample units.
<br>
If <code>split</code> ist set to <code>TRUE</code> and <code>pid</code> is specified, the bootstrap replicates
are carried forward using the personal identifiers instead of the household
identifier.
This takes into account the issue of a houshold splitting up.
Any person in this new split household will get the same bootstrap replicate
as the person that has come from an other household in the survey.
People who enter already existing households will also get the same bootstrap
replicate as the other households members had in the previous periods.
<br><code>already.selected</code> can be specified in order to construct bootstrap replicates
considering that already drawn bootstrap replicates from a previous <code>period</code>
exist for the same survey. See <code><a href="get.selection.html">get.selection()</a></code> for more explanations and examples.</p>
    </div>
    <div class="section level2">
    <h2 id="references">References<a class="anchor" aria-label="anchor" href="#references"></a></h2>
    <p>Preston, J. (2009). Rescaled bootstrap for stratified multistage
sampling. Survey Methodology. 35. 227-234.
Rao, J. N. K., and C. F. J. Wu. (1988). Resampling Inference with Complex Survey Data.
Journal of the American Statistical Association 83 (401): 231–41.</p>
    </div>
    <div class="section level2">
    <h2 id="see-also">See also<a class="anchor" aria-label="anchor" href="#see-also"></a></h2>
    <div class="dont-index"><p><code><a href="https://rdatatable.gitlab.io/data.table/reference/data.table.html" class="external-link">data.table</a></code> for more information on
data.table objects.</p></div>
    </div>
    <div class="section level2">
    <h2 id="author">Author<a class="anchor" aria-label="anchor" href="#author"></a></h2>
    <p>Johannes Gussenbauer, Alexander Kowarik, Statistics Austria</p>
    </div>

    <div class="section level2">
    <h2 id="ref-examples">Examples<a class="anchor" aria-label="anchor" href="#ref-examples"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span></span></span>
<span class="r-in"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/statistikat/surveysd" class="external-link">surveysd</a></span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://r-datatable.com" class="external-link">data.table</a></span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdatatable.gitlab.io/data.table/reference/openmp-utils.html" class="external-link">setDTthreads</a></span><span class="op">(</span><span class="fl">1</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">1234</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">eusilc</span> <span class="op">&lt;-</span> <span class="fu"><a href="demo.eusilc.html">demo.eusilc</a></span><span class="op">(</span>n <span class="op">=</span> <span class="fl">3</span>, prettyNames <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">## draw replicates without stratification or clustering</span></span></span>
<span class="r-in"><span><span class="va">dat_boot</span> <span class="op">&lt;-</span> <span class="fu">draw.bootstrap</span><span class="op">(</span><span class="va">eusilc</span>, REP <span class="op">=</span> <span class="fl">1</span>, weights <span class="op">=</span> <span class="st">"pWeight"</span>,</span></span>
<span class="r-in"><span>                           period <span class="op">=</span> <span class="st">"year"</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">## use stratification w.r.t. region and clustering w.r.t. households</span></span></span>
<span class="r-in"><span><span class="va">dat_boot</span> <span class="op">&lt;-</span> <span class="fu">draw.bootstrap</span><span class="op">(</span></span></span>
<span class="r-in"><span>  <span class="va">eusilc</span>, REP <span class="op">=</span> <span class="fl">1</span>, hid <span class="op">=</span> <span class="st">"hid"</span>, weights <span class="op">=</span> <span class="st">"pWeight"</span>,</span></span>
<span class="r-in"><span>  strata <span class="op">=</span> <span class="st">"region"</span>, period <span class="op">=</span> <span class="st">"year"</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">## use multi-level clustering</span></span></span>
<span class="r-in"><span><span class="va">dat_boot</span> <span class="op">&lt;-</span> <span class="fu">draw.bootstrap</span><span class="op">(</span></span></span>
<span class="r-in"><span>  <span class="va">eusilc</span>, REP <span class="op">=</span> <span class="fl">1</span>, hid <span class="op">=</span> <span class="st">"hid"</span>, weights <span class="op">=</span> <span class="st">"pWeight"</span>,</span></span>
<span class="r-in"><span>  strata <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"region"</span>, <span class="st">"hsize"</span><span class="op">)</span>, period <span class="op">=</span> <span class="st">"year"</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># create spit households</span></span></span>
<span class="r-in"><span><span class="va">eusilc</span><span class="op">[</span>, <span class="va">pidsplit</span> <span class="op">:=</span> <span class="va">pid</span><span class="op">]</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>          hid  hsize        region    pid       age gender   ecoStat citizenship</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>        &lt;int&gt; &lt;fctr&gt;        &lt;fctr&gt;  &lt;int&gt;    &lt;fctr&gt; &lt;fctr&gt;    &lt;fctr&gt;      &lt;fctr&gt;</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     1:     1      3         Tyrol    101   (25,45] female part time          AT</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     2:     1      3         Tyrol    102   (25,45]   male full time       Other</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     3:     1      3         Tyrol    103 (-Inf,16]   male      &lt;NA&gt;        &lt;NA&gt;</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     4:     2      4         Tyrol    201   (25,45] female  domestic          AT</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     5:     2      4         Tyrol    202   (25,45]   male full time          AT</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>    ---                                                                         </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 44477:  8999      4 Lower Austria 899904 (-Inf,16] female education          AT</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 44478:  9000      1 Upper Austria 900001   (25,45] female full time          AT</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 44479:  5999      1         Tyrol 599901   (25,45]   male full time          AT</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 44480:  7500      2         Tyrol 750001   (45,65]   male full time          AT</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 44481:  7500      2         Tyrol 750002   (45,65] female  disabled          AT</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>          py010n py050n  py090n py100n py110n py120n py130n py140n hy040n</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>           &lt;num&gt;  &lt;num&gt;   &lt;num&gt;  &lt;num&gt;  &lt;num&gt;  &lt;num&gt;  &lt;num&gt;  &lt;num&gt;  &lt;num&gt;</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     1:  9756.25      0    0.00      0      0      0      0      0 4273.9</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     2: 12471.60      0    0.00      0      0      0      0      0 4273.9</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     3:       NA     NA      NA     NA     NA     NA     NA     NA 4273.9</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     4: 12487.03      0    0.00      0      0      0      0      0    0.0</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     5: 42821.23      0    0.00      0      0      0      0      0    0.0</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>    ---                                                                  </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 44477:     0.00      0    0.00      0      0      0      0      0    0.0</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 44478: 13962.56      0    0.00      0      0      0      0      0    0.0</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 44479: 14685.18      0    0.00      0      0      0      0      0    0.0</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 44480: 20606.82      0    0.00      0      0      0      0      0    0.0</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 44481:     0.00      0 3825.63      0      0      0      0      0    0.0</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>         hy050n hy070n hy080n hy090n hy110n hy130n hy145n  eqSS eqIncome</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>          &lt;num&gt;  &lt;num&gt;  &lt;num&gt;  &lt;num&gt;  &lt;num&gt;  &lt;num&gt;  &lt;num&gt; &lt;num&gt;    &lt;num&gt;</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     1: 2428.11      0      0  33.39      0      0      0   1.8 16090.69</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     2: 2428.11      0      0  33.39      0      0      0   1.8 16090.69</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     3: 2428.11      0      0  33.39      0      0      0   1.8 16090.69</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     4: 1549.72      0      0   2.13      0      0      0   2.1 27076.24</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     5: 1549.72      0      0   2.13      0      0      0   2.1 27076.24</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>    ---                                                                 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 44477: 1955.19      0      0   0.00      0      0      0   2.5 26970.02</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 44478:    0.00      0      0 424.85      0      0      0   1.0 20242.09</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 44479:    0.00      0      0 120.65      0      0      0   1.0 14805.83</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 44480:    0.00      0      0   0.00      0      0      0   1.5 24680.88</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 44481:    0.00      0      0   0.00      0      0      0   1.5 24680.88</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>           db090  pWeight  year povertyRisk pidsplit</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>           &lt;num&gt;    &lt;num&gt; &lt;num&gt;      &lt;lgcl&gt;    &lt;int&gt;</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     1: 504.5696 504.5696  2010       FALSE      101</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     2: 504.5696 504.5696  2010       FALSE      102</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     3: 504.5696 504.5696  2010       FALSE      103</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     4: 493.3824 493.3824  2010       FALSE      201</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     5: 493.3824 493.3824  2010       FALSE      202</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>    ---                                             </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 44477: 556.4260 556.4260  2012       FALSE   899904</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 44478: 643.2557 643.2557  2012       FALSE   900001</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 44479: 679.7288 679.7288  2012       FALSE   599901</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 44480: 567.1544 567.1544  2012       FALSE   750001</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 44481: 567.1544 567.1544  2012       FALSE   750002</span>
<span class="r-in"><span><span class="va">year</span> <span class="op">&lt;-</span> <span class="va">eusilc</span><span class="op">[</span>, <span class="fu"><a href="https://rdrr.io/r/base/unique.html" class="external-link">unique</a></span><span class="op">(</span><span class="va">year</span><span class="op">)</span><span class="op">]</span></span></span>
<span class="r-in"><span><span class="va">year</span> <span class="op">&lt;-</span> <span class="va">year</span><span class="op">[</span><span class="op">-</span><span class="fl">1</span><span class="op">]</span></span></span>
<span class="r-in"><span><span class="va">leaf_out</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="kw">for</span><span class="op">(</span><span class="va">y</span> <span class="kw">in</span> <span class="va">year</span><span class="op">)</span> <span class="op">{</span></span></span>
<span class="r-in"><span>  <span class="va">split.person</span> <span class="op">&lt;-</span> <span class="va">eusilc</span><span class="op">[</span></span></span>
<span class="r-in"><span>    <span class="va">year</span> <span class="op">==</span> <span class="op">(</span><span class="va">y</span><span class="op">-</span><span class="fl">1</span><span class="op">)</span> <span class="op">&amp;</span> <span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/duplicated.html" class="external-link">duplicated</a></span><span class="op">(</span><span class="va">hid</span><span class="op">)</span> <span class="op">&amp;</span> <span class="op">!</span><span class="op">(</span><span class="va">hid</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="va">leaf_out</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>    <span class="fu"><a href="https://rdrr.io/r/base/sample.html" class="external-link">sample</a></span><span class="op">(</span><span class="va">pid</span>, <span class="fl">20</span><span class="op">)</span></span></span>
<span class="r-in"><span>  <span class="op">]</span></span></span>
<span class="r-in"><span>  <span class="va">overwrite.person</span> <span class="op">&lt;-</span> <span class="va">eusilc</span><span class="op">[</span></span></span>
<span class="r-in"><span>    <span class="op">(</span><span class="va">year</span> <span class="op">==</span> <span class="op">(</span><span class="va">y</span><span class="op">)</span><span class="op">)</span> <span class="op">&amp;</span> <span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/duplicated.html" class="external-link">duplicated</a></span><span class="op">(</span><span class="va">hid</span><span class="op">)</span> <span class="op">&amp;</span> <span class="op">!</span><span class="op">(</span><span class="va">hid</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="va">leaf_out</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>    <span class="fu">.</span><span class="op">(</span>pid <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sample.html" class="external-link">sample</a></span><span class="op">(</span><span class="va">pid</span>, <span class="fl">20</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span>  <span class="op">]</span></span></span>
<span class="r-in"><span>  <span class="va">overwrite.person</span><span class="op">[</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"pidsplit"</span>, <span class="st">"year_curr"</span><span class="op">)</span> <span class="op">:=</span> <span class="fu">.</span><span class="op">(</span><span class="va">split.person</span>, <span class="va">y</span><span class="op">)</span><span class="op">]</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span>  <span class="va">eusilc</span><span class="op">[</span><span class="va">overwrite.person</span>, <span class="va">pidsplit</span> <span class="op">:=</span> <span class="va">i.pidsplit</span>,</span></span>
<span class="r-in"><span>         on <span class="op">=</span> <span class="fu">.</span><span class="op">(</span><span class="va">pid</span>, <span class="va">year</span> <span class="op">&gt;=</span> <span class="va">year_curr</span><span class="op">)</span><span class="op">]</span></span></span>
<span class="r-in"><span>  <span class="va">leaf_out</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">leaf_out</span>,</span></span>
<span class="r-in"><span>                <span class="va">eusilc</span><span class="op">[</span><span class="va">pid</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">overwrite.person</span><span class="op">$</span><span class="va">pid</span>,</span></span>
<span class="r-in"><span>                                  <span class="va">overwrite.person</span><span class="op">$</span><span class="va">pidsplit</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>                <span class="fu"><a href="https://rdrr.io/r/base/unique.html" class="external-link">unique</a></span><span class="op">(</span><span class="va">hid</span><span class="op">)</span><span class="op">]</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="op">}</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="va">dat_boot</span> <span class="op">&lt;-</span> <span class="fu">draw.bootstrap</span><span class="op">(</span></span></span>
<span class="r-in"><span>  <span class="va">eusilc</span>, REP <span class="op">=</span> <span class="fl">1</span>, hid <span class="op">=</span> <span class="st">"hid"</span>, weights <span class="op">=</span> <span class="st">"pWeight"</span>,</span></span>
<span class="r-in"><span>  strata <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"region"</span>, <span class="st">"hsize"</span><span class="op">)</span>, period <span class="op">=</span> <span class="st">"year"</span>, split <span class="op">=</span> <span class="cn">TRUE</span>,</span></span>
<span class="r-in"><span>  pid <span class="op">=</span> <span class="st">"pidsplit"</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="co"># split households were considered e.g. household and</span></span></span>
<span class="r-in"><span><span class="co"># split household were both selected or not selected</span></span></span>
<span class="r-in"><span><span class="va">dat_boot</span><span class="op">[</span>, <span class="fu">data.table</span><span class="fu">::</span><span class="fu"><a href="https://rdatatable.gitlab.io/data.table/reference/duplicated.html" class="external-link">uniqueN</a></span><span class="op">(</span><span class="va">w1</span><span class="op">)</span>, by <span class="op">=</span> <span class="va">pidsplit</span><span class="op">]</span><span class="op">[</span><span class="va">V1</span> <span class="op">&gt;</span> <span class="fl">1</span><span class="op">]</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Empty data.table (0 rows and 2 cols): pidsplit,V1</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span></span></span>
</code></pre></div>
    </div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside></div>


    <footer><div class="pkgdown-footer-left">
  <p>Developed by Johannes Gussenbauer, Alexander Kowarik, Eileen Vattheuer, Gregor de Cillia.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.2.0.</p>
</div>

    </footer></div>





  </body></html>

