<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Iterative Proportional Fitting • surveysd</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="96x96" href="../favicon-96x96.png">
<link rel="icon" type="”image/svg+xml”" href="../favicon.svg">
<link rel="apple-touch-icon" sizes="180x180" href="../apple-touch-icon.png">
<link rel="icon" sizes="any" href="../favicon.ico">
<link rel="manifest" href="../site.webmanifest">
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><link href="../extra.css" rel="stylesheet">
<meta property="og:title" content="Iterative Proportional Fitting">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">surveysd</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="Released version">2.0.1</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../articles/surveysd.html">Get started</a></li>
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="active nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles">
<li><a class="dropdown-item" href="../articles/error_estimation.html">Error estimation</a></li>
    <li><a class="dropdown-item" href="../articles/ipf.html">Iterative Proportional Fitting</a></li>
    <li><a class="dropdown-item" href="../articles/methodology.html">Methodology</a></li>
    <li><a class="dropdown-item" href="../articles/raowu.html">Rao-Wu Bootstrap in surveysd</a></li>
  </ul>
</li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/statistikat/surveysd/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.png" class="logo" alt=""><h1>Iterative Proportional Fitting</h1>
                        <h4 data-toc-skip class="author">Gregor de
Cillia</h4>
            
      
      <small class="dont-index">Source: <a href="https://github.com/statistikat/surveysd/blob/2.0.0/vignettes/ipf.Rmd" class="external-link"><code>vignettes/ipf.Rmd</code></a></small>
      <div class="d-none name"><code>ipf.Rmd</code></div>
    </div>

    
    
<p>This vignette explains the usage of the <code><a href="../reference/ipf.html">ipf()</a></code> function,
which has been used for calibrating the labour force survey of Austria
for several years. It is based on the Iterative Proportional Fitting
algorithm and gives some flexibility about the details of the
implementation. See <span class="citation">(Meraner, Gumprecht, and
Kowarik 2016)</span> or <code><a href="../articles/methodology.html">vignette("methodology")</a></code> for more
details.</p>
<div class="section level2">
<h2 id="setup">Setup<a class="anchor" aria-label="anchor" href="#setup"></a>
</h2>
<p>We will assume the output of <code><a href="../reference/demo.eusilc.html">demo.eusilc()</a></code> is our
population. From this population, a sample without replacement is drawn.
The sample covers 10 percent of the population. We assign a weight of
one for all observations of the population and a weight of ten for all
observations of the sample.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/statistikat/surveysd" class="external-link">surveysd</a></span><span class="op">)</span></span>
<span><span class="va">population</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/demo.eusilc.html">demo.eusilc</a></span><span class="op">(</span><span class="fl">1</span>, prettyNames <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="va">population</span><span class="op">[</span>, <span class="va">pWeight</span> <span class="op">:=</span> <span class="fl">1</span><span class="op">]</span></span>
<span><span class="va">pop_sample</span> <span class="op">&lt;-</span> <span class="va">population</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/sample.html" class="external-link">sample</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="va">.N</span>, <span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">floor</a></span><span class="op">(</span><span class="va">.N</span><span class="op">*</span><span class="fl">0.10</span><span class="op">)</span><span class="op">)</span>, <span class="op">]</span></span>
<span><span class="va">pop_sample</span><span class="op">[</span>, <span class="va">pWeight</span> <span class="op">:=</span> <span class="fl">10</span><span class="op">]</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="one-constraint-one-variable">One constraint, one variable<a class="anchor" aria-label="anchor" href="#one-constraint-one-variable"></a>
</h2>
<p>We will start with an example where we want to adapt the weights of
<code>pop_sample</code> such that the weighted number of males and
females matches the ones of <code>population</code>. We can see that
this is currently not the case.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="op">(</span><span class="va">gender_distribution</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/xtabs.html" class="external-link">xtabs</a></span><span class="op">(</span><span class="va">pWeight</span> <span class="op">~</span> <span class="va">gender</span>, <span class="va">population</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; gender</span></span>
<span><span class="co">#&gt;   male female </span></span>
<span><span class="co">#&gt;   7267   7560</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/stats/xtabs.html" class="external-link">xtabs</a></span><span class="op">(</span><span class="va">pWeight</span> <span class="op">~</span> <span class="va">gender</span>, <span class="va">pop_sample</span><span class="op">)</span></span>
<span><span class="co">#&gt; gender</span></span>
<span><span class="co">#&gt;   male female </span></span>
<span><span class="co">#&gt;   7380   7440</span></span></code></pre></div>
<p>Due to random sampling (rather than stratified sampling), there are
differences between the gender distributions. We can pass
<code>gender_distribution</code> as a parameter to <code><a href="../reference/ipf.html">ipf()</a></code> to
obtain modified weights.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">pop_sample_c</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/ipf.html">ipf</a></span><span class="op">(</span><span class="va">pop_sample</span>, conP <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="va">gender_distribution</span><span class="op">)</span>, w <span class="op">=</span> <span class="st">"pWeight"</span><span class="op">)</span></span></code></pre></div>
<p>The resulting dataset, <code>pop_sample_c</code> is similar to
<code>pop_sample</code> but has an additional column with the adjusted
weights.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/dim.html" class="external-link">dim</a></span><span class="op">(</span><span class="va">pop_sample</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] 1482   30</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/dim.html" class="external-link">dim</a></span><span class="op">(</span><span class="va">pop_sample_c</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] 1482   31</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/sets.html" class="external-link">setdiff</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">pop_sample_c</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">pop_sample</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] "calibWeight"</span></span></code></pre></div>
<p>We can now calculate the weighted number of males and females
according to this new weight. This will result in a match for the
constraints.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/stats/xtabs.html" class="external-link">xtabs</a></span><span class="op">(</span><span class="va">calibWeight</span> <span class="op">~</span> <span class="va">gender</span>, <span class="va">pop_sample_c</span><span class="op">)</span></span>
<span><span class="co">#&gt; gender</span></span>
<span><span class="co">#&gt;   male female </span></span>
<span><span class="co">#&gt;   7267   7560</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/stats/xtabs.html" class="external-link">xtabs</a></span><span class="op">(</span><span class="va">pWeight</span> <span class="op">~</span> <span class="va">gender</span>, <span class="va">population</span><span class="op">)</span></span>
<span><span class="co">#&gt; gender</span></span>
<span><span class="co">#&gt;   male female </span></span>
<span><span class="co">#&gt;   7267   7560</span></span></code></pre></div>
<p>In this simple case, <code>ipf</code> just performs a post
stratification step. This means, that all males and all females have the
same weight.</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/stats/xtabs.html" class="external-link">xtabs</a></span><span class="op">(</span><span class="op">~</span> <span class="va">calibWeight</span> <span class="op">+</span> <span class="va">gender</span>, <span class="va">pop_sample_c</span><span class="op">)</span></span>
<span><span class="co">#&gt;                   gender</span></span>
<span><span class="co">#&gt; calibWeight        male female</span></span>
<span><span class="co">#&gt;   9.84688346883469  738      0</span></span>
<span><span class="co">#&gt;   10.1612903225806    0    744</span></span></code></pre></div>
<p>All males have been weighted down (<code>calibWeight &lt; 10</code>)
to compensate for the overrepresentation in the sample.</p>
</div>
<div class="section level2">
<h2 id="one-constraint-two-variables">One constraint, two variables<a class="anchor" aria-label="anchor" href="#one-constraint-two-variables"></a>
</h2>
<p>Let’s now assume that we want to put constraints on the number of
males and females for each age group. The numbers from the original
population can be obtained with <code><a href="https://rdrr.io/r/stats/xtabs.html" class="external-link">xtabs()</a></code>.</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="op">(</span><span class="va">con_ga</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/xtabs.html" class="external-link">xtabs</a></span><span class="op">(</span><span class="va">pWeight</span> <span class="op">~</span> <span class="va">gender</span> <span class="op">+</span> <span class="va">age</span>, <span class="va">population</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt;         age</span></span>
<span><span class="co">#&gt; gender   (-Inf,16] (16,25] (25,45] (45,65] (65, Inf]</span></span>
<span><span class="co">#&gt;   male        1528     855    2165    1822       897</span></span>
<span><span class="co">#&gt;   female      1375     848    2255    1845      1237</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/stats/xtabs.html" class="external-link">xtabs</a></span><span class="op">(</span><span class="va">pWeight</span> <span class="op">~</span> <span class="va">gender</span> <span class="op">+</span> <span class="va">age</span>, <span class="va">pop_sample</span><span class="op">)</span></span>
<span><span class="co">#&gt;         age</span></span>
<span><span class="co">#&gt; gender   (-Inf,16] (16,25] (25,45] (45,65] (65, Inf]</span></span>
<span><span class="co">#&gt;   male        1480     870    2310    1830       890</span></span>
<span><span class="co">#&gt;   female      1620     780    2180    1690      1170</span></span></code></pre></div>
<p>Again, we can see that those constraints are not met. Supplying the
contingency table <code>con_ga</code> to <code><a href="../reference/ipf.html">ipf()</a></code> will again
resolve this.</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">pop_sample_c2</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/ipf.html">ipf</a></span><span class="op">(</span><span class="va">pop_sample</span>, conP <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="va">con_ga</span><span class="op">)</span>, w <span class="op">=</span> <span class="st">"pWeight"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/stats/xtabs.html" class="external-link">xtabs</a></span><span class="op">(</span><span class="va">pWeight</span> <span class="op">~</span> <span class="va">gender</span> <span class="op">+</span> <span class="va">age</span>, <span class="va">population</span><span class="op">)</span></span>
<span><span class="co">#&gt;         age</span></span>
<span><span class="co">#&gt; gender   (-Inf,16] (16,25] (25,45] (45,65] (65, Inf]</span></span>
<span><span class="co">#&gt;   male        1528     855    2165    1822       897</span></span>
<span><span class="co">#&gt;   female      1375     848    2255    1845      1237</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/stats/xtabs.html" class="external-link">xtabs</a></span><span class="op">(</span><span class="va">calibWeight</span> <span class="op">~</span> <span class="va">gender</span> <span class="op">+</span> <span class="va">age</span>, <span class="va">pop_sample_c2</span><span class="op">)</span></span>
<span><span class="co">#&gt;         age</span></span>
<span><span class="co">#&gt; gender   (-Inf,16] (16,25] (25,45] (45,65] (65, Inf]</span></span>
<span><span class="co">#&gt;   male        1528     855    2165    1822       897</span></span>
<span><span class="co">#&gt;   female      1375     848    2255    1845      1237</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="two-constraints">Two constraints<a class="anchor" aria-label="anchor" href="#two-constraints"></a>
</h2>
<p>Now we assume that we know the number of persons living in each nuts2
region from registry data.</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">registry_table</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/xtabs.html" class="external-link">xtabs</a></span><span class="op">(</span><span class="va">pWeight</span> <span class="op">~</span> <span class="va">region</span>, <span class="va">population</span><span class="op">)</span></span></code></pre></div>
<p>However, those registry data does not provide any information about
age or <code>gender</code>. Therefore, the two contingency tables
(<code>con_ga</code> and <code>registry_table</code>) have to be
specified independently. This can be done by supplying a list to
<code>conP</code></p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">pop_sample_c2</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/ipf.html">ipf</a></span><span class="op">(</span><span class="va">pop_sample</span>, conP <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="va">con_ga</span>, <span class="va">registry_table</span><span class="op">)</span>, w <span class="op">=</span> <span class="st">"pWeight"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/stats/xtabs.html" class="external-link">xtabs</a></span><span class="op">(</span><span class="va">pWeight</span> <span class="op">~</span> <span class="va">gender</span> <span class="op">+</span> <span class="va">age</span>, <span class="va">population</span><span class="op">)</span></span>
<span><span class="co">#&gt;         age</span></span>
<span><span class="co">#&gt; gender   (-Inf,16] (16,25] (25,45] (45,65] (65, Inf]</span></span>
<span><span class="co">#&gt;   male        1528     855    2165    1822       897</span></span>
<span><span class="co">#&gt;   female      1375     848    2255    1845      1237</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/stats/xtabs.html" class="external-link">xtabs</a></span><span class="op">(</span><span class="va">calibWeight</span> <span class="op">~</span> <span class="va">gender</span> <span class="op">+</span> <span class="va">age</span>, <span class="va">pop_sample_c2</span><span class="op">)</span></span>
<span><span class="co">#&gt;         age</span></span>
<span><span class="co">#&gt; gender   (-Inf,16]   (16,25]   (25,45]   (45,65] (65, Inf]</span></span>
<span><span class="co">#&gt;   male   1528.0003  854.9994 2164.9996 1821.9998  897.0004</span></span>
<span><span class="co">#&gt;   female 1374.9999  847.9999 2255.0012 1845.0003 1236.9992</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/stats/xtabs.html" class="external-link">xtabs</a></span><span class="op">(</span><span class="va">pWeight</span> <span class="op">~</span> <span class="va">region</span>, <span class="va">population</span><span class="op">)</span></span>
<span><span class="co">#&gt; region</span></span>
<span><span class="co">#&gt;    Burgenland     Carinthia Lower Austria      Salzburg        Styria </span></span>
<span><span class="co">#&gt;           549          1078          2804           924          2295 </span></span>
<span><span class="co">#&gt;         Tyrol Upper Austria        Vienna    Vorarlberg </span></span>
<span><span class="co">#&gt;          1317          2805          2322           733</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/stats/xtabs.html" class="external-link">xtabs</a></span><span class="op">(</span><span class="va">calibWeight</span> <span class="op">~</span> <span class="va">region</span>, <span class="va">pop_sample_c2</span><span class="op">)</span></span>
<span><span class="co">#&gt; region</span></span>
<span><span class="co">#&gt;    Burgenland     Carinthia Lower Austria      Salzburg        Styria </span></span>
<span><span class="co">#&gt;           549          1078          2804           924          2295 </span></span>
<span><span class="co">#&gt;         Tyrol Upper Austria        Vienna    Vorarlberg </span></span>
<span><span class="co">#&gt;          1317          2805          2322           733</span></span></code></pre></div>
<p>this time, the constraints are not matched perfectly. That is,
because we provided more than one constraint. therefore, the
<code><a href="../reference/ipf.html">ipf()</a></code> algorithm had to work iteratively.</p>
</div>
<div class="section level2">
<h2 id="household-constraints">Household Constraints<a class="anchor" aria-label="anchor" href="#household-constraints"></a>
</h2>
<p>If the dataset has a household structure, household constraints can
be passed via the parameter <code>conH</code>. If this parameter is
used, it is also necessary to supply <code>hid</code>, which defines the
column names that contains household ids.</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="op">(</span><span class="va">conH1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/xtabs.html" class="external-link">xtabs</a></span><span class="op">(</span><span class="va">pWeight</span> <span class="op">~</span> <span class="va">hsize</span> <span class="op">+</span> <span class="va">region</span>, data <span class="op">=</span> <span class="va">population</span><span class="op">[</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/duplicated.html" class="external-link">duplicated</a></span><span class="op">(</span><span class="va">hid</span><span class="op">)</span><span class="op">]</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt;      region</span></span>
<span><span class="co">#&gt; hsize Burgenland Carinthia Lower Austria Salzburg Styria Tyrol Upper Austria</span></span>
<span><span class="co">#&gt;     1         58       117           325      103    264   118           262</span></span>
<span><span class="co">#&gt;     2         82       126           345      102    260   149           321</span></span>
<span><span class="co">#&gt;     3         37        80           189       55    187    79           203</span></span>
<span><span class="co">#&gt;     4         33        63           169       71    122   102           168</span></span>
<span><span class="co">#&gt;     5         16        39           103       30     83    48           114</span></span>
<span><span class="co">#&gt;      region</span></span>
<span><span class="co">#&gt; hsize Vienna Vorarlberg</span></span>
<span><span class="co">#&gt;     1    431         67</span></span>
<span><span class="co">#&gt;     2    355         72</span></span>
<span><span class="co">#&gt;     3    175         44</span></span>
<span><span class="co">#&gt;     4     96         53</span></span>
<span><span class="co">#&gt;     5     50         34</span></span>
<span><span class="va">pop_sample_hh</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/ipf.html">ipf</a></span><span class="op">(</span><span class="va">pop_sample</span>, hid <span class="op">=</span> <span class="st">"hid"</span>, conH <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="va">conH1</span><span class="op">)</span>, w <span class="op">=</span> <span class="st">"pWeight"</span>,</span>
<span>                     bound <span class="op">=</span> <span class="fl">10</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/stats/xtabs.html" class="external-link">xtabs</a></span><span class="op">(</span><span class="va">calibWeight</span> <span class="op">~</span> <span class="va">hsize</span> <span class="op">+</span> <span class="va">region</span>, data <span class="op">=</span> <span class="va">pop_sample_hh</span><span class="op">[</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/duplicated.html" class="external-link">duplicated</a></span><span class="op">(</span><span class="va">hid</span><span class="op">)</span><span class="op">]</span><span class="op">)</span></span>
<span><span class="co">#&gt;      region</span></span>
<span><span class="co">#&gt; hsize Burgenland Carinthia Lower Austria Salzburg Styria Tyrol Upper Austria</span></span>
<span><span class="co">#&gt;     1         58       117           325      103    264   118           262</span></span>
<span><span class="co">#&gt;     2         82       126           345      102    260   149           321</span></span>
<span><span class="co">#&gt;     3         37        80           189       55    187    79           203</span></span>
<span><span class="co">#&gt;     4         33        63           169       71    122   102           168</span></span>
<span><span class="co">#&gt;     5         16        39           103       30     83    48           114</span></span>
<span><span class="co">#&gt;      region</span></span>
<span><span class="co">#&gt; hsize Vienna Vorarlberg</span></span>
<span><span class="co">#&gt;     1    431         67</span></span>
<span><span class="co">#&gt;     2    355         72</span></span>
<span><span class="co">#&gt;     3    175         44</span></span>
<span><span class="co">#&gt;     4     96         53</span></span>
<span><span class="co">#&gt;     5     50         34</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="tolerances">Tolerances<a class="anchor" aria-label="anchor" href="#tolerances"></a>
</h2>
<p>If <code>conP</code> or <code>conH</code> contain several contingency
tables or if <code>conP</code> and <code>conH</code> are used at the
same time, the ipf algorithm will operate iteratively. This means that
the calibrated dataset will satisfy the constraints only approximately.
The default tolerances of the approximation can be overwritten using the
parameters <code>conP</code> and <code>conH</code>.</p>
<p>Lowering the tolerances will improve the match between the
constraints and the contingency tables according to the calibrated
weights. However, lower tolerances will also make it so more iterations
are necessary until a convergence is met. If the constraints are too
small, ipf will return with a warning that indicates that a convergence
could not be reached.</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/ipf.html">ipf</a></span><span class="op">(</span><span class="va">pop_sample</span>, conP <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="va">con_ga</span>, <span class="va">registry_table</span><span class="op">)</span>, w <span class="op">=</span> <span class="st">"pWeight"</span>,</span>
<span>    verbose <span class="op">=</span> <span class="cn">TRUE</span>, epsP <span class="op">=</span> <span class="fl">0.01</span><span class="op">)</span></span>
<span><span class="co">#&gt; Iteration stopped after 3 steps</span></span>
<span><span class="co">#&gt; Convergence reached</span></span>
<span><span class="fu"><a href="../reference/ipf.html">ipf</a></span><span class="op">(</span><span class="va">pop_sample</span>, conP <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="va">con_ga</span>, <span class="va">registry_table</span><span class="op">)</span>, w <span class="op">=</span> <span class="st">"pWeight"</span>,</span>
<span>    verbose <span class="op">=</span> <span class="cn">TRUE</span>, epsP <span class="op">=</span> <span class="fl">0.0001</span><span class="op">)</span></span>
<span><span class="co">#&gt; Iteration stopped after 3 steps</span></span>
<span><span class="co">#&gt; Convergence reached</span></span></code></pre></div>
<p>We see that changing the tolerances from <code>0.01</code> (one
percent) to <code>0.0001</code> increases the number of required
iterations.</p>
</div>
<div class="section level2 unnumbered">
<h2 class="unnumbered" id="references">References<a class="anchor" aria-label="anchor" href="#references"></a>
</h2>
<div id="refs" class="references csl-bib-body hanging-indent" entry-spacing="0">
<div id="ref-mekogu2016" class="csl-entry">
Meraner, Angelika, Daniela Gumprecht, and Alexander Kowarik. 2016.
<span>“Weighting Procedure of the Austrian Microcensus Using
Administrative Data.”</span> <em>Austrian Journal of Statistics</em> 45
(June): 3. <a href="https://doi.org/10.17713/ajs.v45i3.120" class="external-link">https://doi.org/10.17713/ajs.v45i3.120</a>.
</div>
</div>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by Johannes Gussenbauer, Alexander Kowarik, Eileen Vattheuer, Gregor de Cillia.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.2.0.</p>
</div>

    </footer>
</div>





  </body>
</html>
