<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Rao-Wu Bootstrap in surveysd • surveysd</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="96x96" href="../favicon-96x96.png">
<link rel="icon" type="”image/svg+xml”" href="../favicon.svg">
<link rel="apple-touch-icon" sizes="180x180" href="../apple-touch-icon.png">
<link rel="icon" sizes="any" href="../favicon.ico">
<link rel="manifest" href="../site.webmanifest">
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><link href="../extra.css" rel="stylesheet">
<meta property="og:title" content="Rao-Wu Bootstrap in surveysd">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">surveysd</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="Released version">2.0.0</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../articles/surveysd.html">Get started</a></li>
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="active nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles">
<li><a class="dropdown-item" href="../articles/error_estimation.html">Error estimation</a></li>
    <li><a class="dropdown-item" href="../articles/ipf.html">Iterative Proportional Fitting</a></li>
    <li><a class="dropdown-item" href="../articles/methodology.html">Methodology</a></li>
    <li><a class="dropdown-item" href="../articles/raowu.html">Rao-Wu Bootstrap in surveysd</a></li>
  </ul>
</li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/statistikat/surveysd/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.png" class="logo" alt=""><h1>Rao-Wu Bootstrap in surveysd</h1>
            
            <h4 data-toc-skip class="date">2025-09-04</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/statistikat/surveysd/blob/master/vignettes/raowu.Rmd" class="external-link"><code>vignettes/raowu.Rmd</code></a></small>
      <div class="d-none name"><code>raowu.Rmd</code></div>
    </div>

    
    
<p>In the following we describe an extension of the methodology
implemented in <code>surveysd</code>. While the default rescaling method
described in <code>vignette("Methodology")</code> follows the approach
of Preston, this vignette introduces an alternative rescaling method
based on the Rao-Wu bootstrap <span class="citation">(Rao and Wu
1988)</span>.</p>
<div class="section level3">
<h3 id="mathematical-formulation">Mathematical Formulation<a class="anchor" aria-label="anchor" href="#mathematical-formulation"></a>
</h3>
<p>More formally, the replicate weights are constructed as follows:
<math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msubsup><mi>w</mi><mrow><mi>h</mi><mi>i</mi></mrow><mo>*</mo></msubsup><mo>=</mo><mrow><mo stretchy="true" form="prefix">(</mo><mn>1</mn><mo>−</mo><msub><mi>λ</mi><mi>h</mi></msub><mo>+</mo><msub><mi>λ</mi><mi>h</mi></msub><mo>⋅</mo><mfrac><msub><mi>n</mi><mi>h</mi></msub><msub><mi>m</mi><mi>h</mi></msub></mfrac><mo>⋅</mo><msubsup><mi>r</mi><mrow><mi>h</mi><mi>i</mi></mrow><mo>*</mo></msubsup><mo stretchy="true" form="postfix">)</mo></mrow><mo>⋅</mo><msub><mi>w</mi><mrow><mi>h</mi><mi>i</mi></mrow></msub></mrow><annotation encoding="application/x-tex">
w^*_{hi} = \left(1 - \lambda_h + \lambda_h \cdot \frac{n_h}{m_h} \cdot r^*_{hi} \right) \cdot w_{hi}
</annotation></semantics></math> with
<math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>λ</mi><mi>h</mi></msub><mo>=</mo><msqrt><mfrac><mrow><msub><mi>m</mi><mi>h</mi></msub><mrow><mo stretchy="true" form="prefix">(</mo><mn>1</mn><mo>−</mo><msub><mi>f</mi><mi>h</mi></msub><mo stretchy="true" form="postfix">)</mo></mrow></mrow><mrow><msub><mi>n</mi><mi>h</mi></msub><mo>−</mo><mn>1</mn></mrow></mfrac></msqrt></mrow><annotation encoding="application/x-tex">
 \lambda_h = \sqrt{\frac{m_h(1 - f_h)}{n_h - 1}}
</annotation></semantics></math> where:<br> -
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>w</mi><mrow><mi>h</mi><mi>i</mi></mrow></msub><annotation encoding="application/x-tex">w_{hi}</annotation></semantics></math>
is the design weight for PSU
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>i</mi><annotation encoding="application/x-tex">i</annotation></semantics></math>
in stratum
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>h</mi><annotation encoding="application/x-tex">h</annotation></semantics></math>,
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>w</mi><mi>h</mi></msub><mo>=</mo><msub><mi>N</mi><mi>h</mi></msub><mi>/</mi><msub><mi>n</mi><mi>h</mi></msub></mrow><annotation encoding="application/x-tex">w_h = N_h / n_h</annotation></semantics></math>
is the average design weight for the entire stratum
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>h</mi><annotation encoding="application/x-tex">h</annotation></semantics></math>,<br>
-
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>N</mi><mi>h</mi></msub><annotation encoding="application/x-tex">N_h</annotation></semantics></math>
is the total number of units in stratum
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>h</mi><annotation encoding="application/x-tex">h</annotation></semantics></math>,<br>
-
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>n</mi><mi>h</mi></msub><annotation encoding="application/x-tex">n_h</annotation></semantics></math>
is the number of PSUs in the original sample for stratum
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>h</mi><annotation encoding="application/x-tex">h</annotation></semantics></math>,<br>
-
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msubsup><mi>r</mi><mrow><mi>h</mi><mi>i</mi></mrow><mo>*</mo></msubsup><mo>∈</mo><mo stretchy="false" form="prefix">{</mo><mn>0</mn><mo>,</mo><mn>1</mn><mo>,</mo><mn>2</mn><mo>,</mo><mi>…</mi><mo stretchy="false" form="postfix">}</mo></mrow><annotation encoding="application/x-tex">r^*_{hi} \in \{0, 1, 2, \dots\}</annotation></semantics></math>
is a <strong>resampling indicator</strong> that represents how many
times PSU
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>i</mi><annotation encoding="application/x-tex">i</annotation></semantics></math>
in stratum
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>h</mi><annotation encoding="application/x-tex">h</annotation></semantics></math>
was drawn in the bootstrap ,<br> -
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>m</mi><mi>h</mi></msub><mo>=</mo><msub><mi>n</mi><mi>h</mi></msub><mo>−</mo><mn>1</mn></mrow><annotation encoding="application/x-tex">m_h = n_h - 1</annotation></semantics></math>
is the <strong>number of units</strong> to be drawn in each replicate
for stratum
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>h</mi><annotation encoding="application/x-tex">h</annotation></semantics></math>,<br>
-
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>λ</mi><mi>h</mi></msub><annotation encoding="application/x-tex">\lambda_h</annotation></semantics></math>
is the <strong>scaling factor</strong> used to adjust the weights during
the bootstrap process,<br> - and
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>f</mi><mi>h</mi></msub><mo>=</mo><msub><mi>n</mi><mi>h</mi></msub><mi>/</mi><msub><mi>N</mi><mi>h</mi></msub></mrow><annotation encoding="application/x-tex">f_h = n_h / N_h</annotation></semantics></math>
is the <strong>sampling fraction</strong> in stratum
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>h</mi><annotation encoding="application/x-tex">h</annotation></semantics></math>.<br></p>
</div>
<div class="section level3">
<h3 id="use-of-rao-wu">Use of Rao-Wu<a class="anchor" aria-label="anchor" href="#use-of-rao-wu"></a>
</h3>
<p>The Rao-Wu bootstrap is particularly suited for complex survey
designs with stratification and multi-stage selection. The design-based
variance estimation benefits from a resampling method that accounts for
the primary sampling stage and incorporates finite population
corrections (FPC) directly in the replicate weights. The method is
appropriate when the sampling fraction in the first stage (i.e., the
share of selected PSUs within strata) is relatively small, typically
below 10%.</p>
<p>Rao-Wu is <strong>not suitable</strong> when:<br> - The sampling
fraction in the first stage is large and the first-stage sampling is
without replacement.<br> - The survey does not include PSU-level
identifiers, making a first-stage resampling infeasible since the method
requires resampling entire PSUs to reflect first-stage sampling
variability.<br> - The design is single-stage, where methods like the
Preston bootstrap may be more appropriate.<br></p>
<p>In those cases, it is recommended to fall back on alternative
bootstrap methods such as the default Preston approach implemented in
<code>surveysd</code>, which offers more flexibility for a wider range
of designs without PSU information.</p>
</div>
<div class="section level3">
<h3 id="single-psus">Single PSUs<a class="anchor" aria-label="anchor" href="#single-psus"></a>
</h3>
<p>When dealing with multistage sampling designs, the issue of single
PSUs, e.g. a single response unit at a stage or in a stratum, can arise.
When applying resampling methods such as the Rao-Wu bootstrap, these
single PSUs can introduce challenges in the resampling process. In the
Rao-Wu method, we adjust for the presence of single PSUs by combining
them with the next smallest stratum or cluster before applying the
resampling procedure. This ensures that the resampling reflects the
structure of the original design while maintaining appropriate variance
estimates for the total and other statistics of interest.</p>
</div>
<div class="section level3">
<h3 id="example-implementation">Example Implementation<a class="anchor" aria-label="anchor" href="#example-implementation"></a>
</h3>
<div class="section level4">
<h4 id="load-dataset">Load Dataset<a class="anchor" aria-label="anchor" href="#load-dataset"></a>
</h4>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/statistikat/surveysd" class="external-link">surveysd</a></span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">1234</span><span class="op">)</span></span>
<span><span class="va">eusilc</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/demo.eusilc.html">demo.eusilc</a></span><span class="op">(</span>n <span class="op">=</span> <span class="fl">2</span>, prettyNames <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span></span>
<span><span class="va">eusilc</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">5</span>, <span class="fu">.</span><span class="op">(</span><span class="va">year</span>, <span class="va">povertyRisk</span>, <span class="va">gender</span>, <span class="va">pWeight</span><span class="op">)</span><span class="op">]</span></span></code></pre></div>
</div>
<div class="section level4">
<h4 id="draw-bootstrap-replicates">Draw bootstrap replicates<a class="anchor" aria-label="anchor" href="#draw-bootstrap-replicates"></a>
</h4>
<p>For the bootstrap select ‘method = “Rao-Wu”’. Otherwise the default
“Preston” is used.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">dat_boot_rw</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/draw.bootstrap.html">draw.bootstrap</a></span><span class="op">(</span><span class="va">eusilc</span>, </span>
<span>                              method <span class="op">=</span> <span class="st">"Rao-Wu"</span>,</span>
<span>                              REP <span class="op">=</span> <span class="fl">10</span>, </span>
<span>                              hid <span class="op">=</span> <span class="st">"hid"</span>, </span>
<span>                              weights <span class="op">=</span> <span class="st">"pWeight"</span>, </span>
<span>                              strata <span class="op">=</span> <span class="st">"region"</span>, </span>
<span>                              period <span class="op">=</span> <span class="st">"year"</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level4">
<h4 id="calibrate-bootstrap-replicates">Calibrate bootstrap replicates<a class="anchor" aria-label="anchor" href="#calibrate-bootstrap-replicates"></a>
</h4>
<p>Calibrate each sample according to the distribution of
<code>gender</code> (on a personal level) and <code>region</code> (on a
household level).</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">dat_boot_calib</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/recalib.html">recalib</a></span><span class="op">(</span><span class="va">dat_boot_rw</span>, </span>
<span>                          conP.var <span class="op">=</span> <span class="st">"gender"</span>, </span>
<span>                          conH.var <span class="op">=</span> <span class="st">"region"</span>,</span>
<span>                          epsP <span class="op">=</span> <span class="fl">1e-2</span>, </span>
<span>                          epsH <span class="op">=</span> <span class="fl">2.5e-2</span>, </span>
<span>                          verbose <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span><span class="va">dat_boot_calib</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">5</span>, <span class="fu">.</span><span class="op">(</span><span class="va">year</span>, <span class="va">povertyRisk</span>, <span class="va">gender</span>, <span class="va">pWeight</span>, <span class="va">w1</span>, <span class="va">w2</span>, <span class="va">w3</span>, <span class="va">w4</span><span class="op">)</span><span class="op">]</span></span></code></pre></div>
<div id="refs" class="references csl-bib-body hanging-indent" entry-spacing="0">
<div id="ref-raowu1988" class="csl-entry">
Rao, J. N. K., and C. F. J. Wu. 1988. <span>“Resampling Inference with
Complex Survey Data.”</span> <em>Journal of the American Statistical
Association</em> 83 (401): 231–41.
</div>
</div>
</div>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by Johannes Gussenbauer, Alexander Kowarik, Eileen Vattheuer, Gregor de Cillia.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.3.</p>
</div>

    </footer>
</div>





  </body>
</html>
